<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  




<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT, Zoey" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="CS | Web | Write | Music">
<meta property="og:type" content="website">
<meta property="og:title" content="Zhuo Han">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Zhuo Han">
<meta property="og:description" content="CS | Web | Write | Music">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Zhuo Han">
<meta name="twitter:description" content="CS | Web | Write | Music">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Zoey'
    }
  };
</script>

  <title> Zhuo Han </title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  


<!-- hexo-inject:begin --><!-- hexo-inject:end --><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-113008849-1', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?a03836ec239f375669ad8f7cb87ff77c";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Zhuo Han</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/04/30/Modernize-Old-Movies-through-Colorization-and-Animation/" itemprop="url">
                  Modernize Old Movies through Colorization and Animation
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2019-04-30T14:50:45-07:00" content="2019-04-30">
              2019-04-30
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Course/" itemprop="url" rel="index">
                    <span itemprop="name">Course</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2019/04/30/Modernize-Old-Movies-through-Colorization-and-Animation/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/04/30/Modernize-Old-Movies-through-Colorization-and-Animation/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2019/04/30/Modernize-Old-Movies-through-Colorization-and-Animation/" class="leancloud_visitors" data-flag-title="Modernize Old Movies through Colorization and Animation">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>Team: DeeperFour</strong></p>
<h1>Motivation</h1>
<p>It is a pity to watch old classic movies are being forgotten by people due to limited shooting technology and the relatively boring black-and-white presentations. Therefore, we decided to make those films more enjoyable by filling them with vivid colors by virtue of existing colorization networks, and creating an animated cartoon version thanks to style-transfer techniques. However, existing colorization and animation networks work on independent images. In order to make the final output video smooth and well displayed, we added another image transfer network with a ConvLSTM layer to increase the consistency of the video through short-term and long-term temporal loss between consecutive frames. Training the animation network with different artist’s style, our work can render any black-and-white film with realistic and colorization and cartoon style in specific art style.</p>
<p><img src="https://paper-attachments.dropbox.com/s_33BC8E3177835D6147C233F29AEE7F019BDC905E916E7DC9C92C5E436A454360_1556586599183_Group.png" alt=""></p>
<h1>Previous Works</h1>
<p>DeOldify is a deep learning based model, which presents an approach for colorization, espeically for photos taken with old/bad equipment. It is inspired and a combination of Self-Attention Generative Adversarial Network<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>, Progressive Growing of GANs<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>, Two Time-Scale Update Rule<sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup>.</p>
<p>ConvLSTM, based on a deep recurrent network, proposes a solution to enforcing temporal consistency in a video after image processing algorithms applied. In this work, they minimize the temporal loss(short-term loss and long-term loss) for temporal stability and a perceptual loss for perceptual similarity.</p>
<p>CartoonGAN<sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup> works on transforming real-world photos into cartoon style images with two novel losses: semantic content loss for style variation and the edge-promoting adversarial loss for preserving clear edges.</p>
<p><img src="https://paper-attachments.dropbox.com/s_33BC8E3177835D6147C233F29AEE7F019BDC905E916E7DC9C92C5E436A454360_1556606755019_1.png" alt="CartoonGAN architecture"></p>
<h1>Datasets</h1>
<p>We gathered four Makoto Shinkai’s works: *The Place Promised in Our Early Days(*雲のむこう、約束の場所), *Five Centimeters per Second(*秒速5センチメートル), <em>The Garden of Words(<em>言の葉の庭</em>)</em>, and <em>Your Name(<em>君の名は</em>).</em> <em>First,</em> we clipped the video to frames on a pace of 1 frame per 3 seconds, and then discarded black frames and frames from crew lists. Second, we resized and cropped all frames into size $256\times 256$. And in order to make the generator to generate clearer contours, we augmented the data by dilating and smoothing the edges(regions that were found by Canny edge detector<sup class="footnote-ref"><a href="#fn5" id="fnref5">[5]</a></sup>).</p>
<p><img src="https://paper-attachments.dropbox.com/s_33BC8E3177835D6147C233F29AEE7F019BDC905E916E7DC9C92C5E436A454360_1556500133937_yourname_fig.png" alt=""></p>
<h1>Architectural Design</h1>
<h2 id="initial-idea"><a class="header-anchor" href="#initial-idea">§</a>Initial Idea</h2>
<p><img src="https://paper-attachments.dropbox.com/s_BB923EE403F4FA0B2AC5356A2ED69F4A8FC578950CD21EC48207217EE95E0525_1556491538299_pipeline_basic.png" alt="Basic Implementation"></p>
<p>Initially, we implemented a straight-forward pipeline and let colorization and animation work as building blocks inside of it; we used original video frames as inputs, and let them pass through colorization and animation blocks and then stream together the output frames back to a video.</p>
<p>One of the problems for this approach is that the output video was not stable enough because of significant color gaps and strobes. Therefore we decided to use the initial approach as baseline and moved on to find ways to stabilize the video output.</p>
<p><img src="https://paper-attachments.dropbox.com/s_BB923EE403F4FA0B2AC5356A2ED69F4A8FC578950CD21EC48207217EE95E0525_1556492105849_example.png" alt="Unstable Sequential Frames"></p>
<h2 id="final-solution-pipeline-with-combined-models-and-consistency-loss-functions"><a class="header-anchor" href="#final-solution-pipeline-with-combined-models-and-consistency-loss-functions">§</a>Final Solution: Pipeline with Combined Models and Consistency Loss Functions</h2>
<p><strong>Description</strong><br>
To stabilize the video, we need to make the color and the tone between consecutive frames and of a tandem of frames consistent with each other. We decided to add consistency loss during the training process. The inspiration came from Wei-Sheng Lai’s paper <em>Learning Blind Video Temporal Consistency</em><sup class="footnote-ref"><a href="#fn6" id="fnref6">[6]</a></sup>. We used a combined loss function of perception loss, short-term and long term temporal loss. VGG perception loss was used to guarantee the quality of the colorized frame, temporal loss was designed to increase the consistency of adjacent frames. Detailed model architecture and loss functions are shown below.</p>
<p><strong>Model Architecture</strong></p>
<p><img src="https://paper-attachments.dropbox.com/s_BB923EE403F4FA0B2AC5356A2ED69F4A8FC578950CD21EC48207217EE95E0525_1556497886918_architecture.png" alt="Detailed Model Architecture"></p>
<p>The above picture shows the model architecture and here are some details in every iteration:</p>
<ul>
<li>Sequential black-and-white frames, denoted as $I_1, …, I_{t-1}, I_{t}$ and frames colorized by pre-trained DeOldify model, denoted as $P_1, …, P_{t-1}, P_t$ are taken as inputs.</li>
<li>Colorized frames: $P_1, …, P_{t-1}, P_t$, are passed through Image Transformation Network, which as a ConvLSTM inside. The network will a function $O_t = P_t + F(P(t))$ to generate the colorized, stabilized output frame, $O_t$.</li>
<li>Meanwhile, $I_1, …, I_{t-1}, I_{t}$ are passed through a pre-trained FlowNet network, which will generate an optimal flow.</li>
<li>The optimal flow will be taken, together with colorized frames: $P _ 1, …, P _ {t-1}, P _ t$, as inputs to the warping layer, which will generate frames $ \hat {O} _ 1, … , \hat {O} _ {t-1}, \hat {O} _ t$, which will work as previous inputs in calculating LSTM loss.</li>
<li>Parameter M, is computed, based on occlusion estimation, which takes  black-and-white frames, $I _ 1, …, I _ {t-1}, I _ {t}$ as inputs. This parameter controls the altitude of the consistency loss based on how different two sequential frames are(If two frames are really different, we will have a really small M, to guarantee long term and short term loss stay at a reasonable scale).</li>
<li>Calculate temporal loss based on short term loss function and long term loss function.</li>
<li>Calculate VGG perceptual loss by passing through a VGG network.</li>
<li>Calculate overall loss, and try to minimize this loss at every iterations.</li>
</ul>
<p><strong>Loss Function</strong></p>
<p>$$\mathcal {L} _ {p}= \sum ^{T} _ {t=2} \sum ^{N} _ {i=1} \sum _ l \Vert \phi _ l(O _ t^{(i)})- \phi _ l(P _ t^{(i)})\Vert _ 1$$</p>
<p>$$\mathcal {L} _ {st}= \sum ^{T} _ {t=2} \sum ^{N} _ {i=1}M _ {t \Rightarrow {}t-1}^{(i)} \Vert O _ t^{(i)}- \hat {O} _ {t-1}^{(i)}\Vert _ 1$$</p>
<p>$$\mathcal {L} _ {lt}= \sum ^{T} _ {t=2} \sum ^{N} _ {i=1}M _ {t \Rightarrow {}t-1}^{(i)} \Vert O _ t^{(i)}- \hat {O} _ {1}^{(i)} \Vert _ 1$$</p>
<p>$$\mathcal {L}= \lambda _ p \mathcal {L} _ p + \lambda _ {st} \mathcal {L} _ {st}+ \lambda _ {lt} \mathcal {L} _ {lt}$$</p>
<p>Notations: $l$ denotes layers, and $\phi_l$ is the activation of the layer $l$. T is the number of frames in the batch, N is the total number of pixels.</p>
<p>VGG loss was used to make sure that the quality of the image corresponds well to human perception.</p>
<p>Short term loss minimize the pixel-by-pixel L-1 loss between two consecutive inputs, making them consistent. The input here are the previous frame that was warped by the pre-trained FlowNet, which will guide the image transformation network learn the transformation of current frame being processed.</p>
<p>Long term loss sums up pair-wise distance of a sequence of frames in the current batch to the first image of the current batch, the distance is the same pixel-by-pixel L-1 loss as used in the short term loss. Memory and speed constrained the length of frames coherence we consider, but we can always decrease batch size to conform with the limits.</p>
<p>Overall loss is a weighted sum of the above losses, the weight hyper-parameters from the paper<sup class="footnote-ref"><a href="#fn6" id="fnref6:1">[6]</a></sup> was used here, because training is too time consuming to tune them. $\lambda_p=10, \lambda_{st} = 100, \lambda_{lt} = 100$.</p>
<h1>Training of the stabilization</h1>
<p>For stabilization, we selected 60 videos with 4,209 frames in total named DAVIS-gray<sup class="footnote-ref"><a href="#fn7" id="fnref7">[7]</a></sup>, which contains a lot of moving objects. And also additional 80 videos with 21,526 frames named VIDEVO-gray videos<sup class="footnote-ref"><a href="#fn8" id="fnref8">[8]</a></sup> as our training set. All frames were processed to be 480x480.</p>
<p>Limited by time, we only managed to finish training for 30 epoch, 1000 batch per epoch, which took around 4 days. Considering the memory limits we had, the long-term loss was handled on a 10 image period.</p>
<h1>Evaluation</h1>
<p>It is difficult to quantify the quality of synthesized images, especially cartoons and videos. Here, we used the warping metric<sup class="footnote-ref"><a href="#fn6" id="fnref6:2">[6]</a></sup> to measure the temporal stability on the output videos.<br>
The metric is based on the flow warping error between two frames,</p>
<p>$$E _ {warp(V _ t, V _ {t+1} ) } = \frac {1} { \sum ^N _ {i=1} M _ t^{ (i) } } \sum ^N _ {i=1} M _ t ^{ (i) } ||V _ t^{ (i) } - \hat {V} _ {t+1} ^ { (i) } || ^ 2 _ 2$$</p>
<p>where $\hat{V_{t+1}}$ is the warped frame $V_{t+1}$ and $M_t \in {0, 1}$ is a non-occlusion mask indicating non-occluded regions, which is based the occlusion detection method in<sup class="footnote-ref"><a href="#fn9" id="fnref9">[9]</a></sup>.<br>
The average warping error over the entire sequence is calculated as:</p>
<p>$$E _ {warp(V)} = \frac {1}{T-1} \sum ^{T-1} _ {t=1} E _ {warp(V _ t, V _ {t+1})}$$</p>
<p><strong>Quantitative evaluation on temporal warping error</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">Videos</th>
<th style="text-align:center">Our model</th>
<th style="text-align:center">Baseline(original processed video)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">psycho_kettle</td>
<td style="text-align:center">0.000293</td>
<td style="text-align:center">0.000688</td>
</tr>
<tr>
<td style="text-align:center">psycho_kiss</td>
<td style="text-align:center">0.000271</td>
<td style="text-align:center">0.000782</td>
</tr>
<tr>
<td style="text-align:center">BeachByDrone</td>
<td style="text-align:center">0.000188</td>
<td style="text-align:center">0.000375</td>
</tr>
<tr>
<td style="text-align:center">Cat</td>
<td style="text-align:center">0.000409</td>
<td style="text-align:center">0.000996</td>
</tr>
<tr>
<td style="text-align:center">CloudsTimelapse</td>
<td style="text-align:center">0.000181</td>
<td style="text-align:center">0.000293</td>
</tr>
<tr>
<td style="text-align:center">TajMahal</td>
<td style="text-align:center">0.000138</td>
<td style="text-align:center">0.000260</td>
</tr>
<tr>
<td style="text-align:center">WestminsterBridge</td>
<td style="text-align:center">0.000224</td>
<td style="text-align:center">0.000450</td>
</tr>
<tr>
<td style="text-align:center">SanFrancisco</td>
<td style="text-align:center">0.000561</td>
<td style="text-align:center">0.000739</td>
</tr>
<tr>
<td style="text-align:center">MotherAndSon</td>
<td style="text-align:center">0.000295</td>
<td style="text-align:center">0.001414</td>
</tr>
<tr>
<td style="text-align:center">WomanWorking</td>
<td style="text-align:center">0.000099</td>
<td style="text-align:center">0.000337</td>
</tr>
<tr>
<td style="text-align:center"><strong>Average</strong></td>
<td style="text-align:center"><strong>0.000266</strong></td>
<td style="text-align:center"><strong>0.000633</strong></td>
</tr>
</tbody>
</table>
<h1>Results</h1>
<h2 id="psycho-videos"><a class="header-anchor" href="#psycho-videos">§</a>Psycho videos</h2>
<table>
<tr>
	<th>Psycho Section I</th>
</tr>
<tr>
	<td>
		<video src="/videos/psycho_kiss_psycho_input_kiss.MP4" controls="controls" style="max-width: 100%; display: block; margin-left: auto; margin-right: auto;">your browser does not support the video tag 
		</video>
		<p style="text-align: center; margin-top: 5px; margin-bottom: 5px;">Baseline Video</p>
	</td>
	<td>
		<video src="/videos/psycho_kiss_psycho_input_kiss_stable.MP4" controls="controls" style="max-width: 100%; display: block; margin-left: auto; margin-right: auto;">your browser does not support the video tag 
		</video>
		<p style="text-align: center; margin-top: 5px; margin-bottom: 5px;">Our Stable Video</p>
	</td>
</tr>
<tr>
	<td>
		<video src="/videos/psycho_kiss_Shinkai.mp4" controls="controls" style="max-width: 100%; display: block; margin-left: auto; margin-right: auto;">your browser does not support the video tag 
		</video>
		<p style="text-align: center; margin-top: 5px; margin-bottom: 5px;">Shinkai Style</p>
	</td>
	<td>
		<video src="/videos/psycho_kiss_Hayao.mp4" controls="controls" style="max-width: 100%; display: block; margin-left: auto; margin-right: auto;">your browser does not support the video tag 
		</video>
		<p style="text-align: center; margin-top: 5px; margin-bottom: 5px;">Hayao Style</p>
	</td>
	<td>
		<video src="/videos/psycho_kiss_Hosoda.mp4" controls="controls" style="max-width: 100%; display: block; margin-left: auto; margin-right: auto;">your browser does not support the video tag 
		</video>
		<p style="text-align: center; margin-top: 5px; margin-bottom: 5px;">Hosoda Style</p>
	</td>
</tr>
</table>
<table>
<tr>
	<th>Psycho Section II</th>
</tr>
<tr>
	<td>
		<video src="/videos/psycho_kettle_psycho_input_kettle.mp4" controls="controls" style="max-width: 100%; display: block; margin-left: auto; margin-right: auto;">your browser does not support the video tag 
		</video>
		<p style="text-align: center; margin-top: 5px; margin-bottom: 5px;">Baseline Video</p>
	</td>
	<td>
		<video src="/videos/psycho_kettle_psycho_input_kettle_stable.mp4" controls="controls" style="max-width: 100%; display: block; margin-left: auto; margin-right: auto;">your browser does not support the video tag 
		</video>
		<p style="text-align: center; margin-top: 5px; margin-bottom: 5px;">Our Stable Video</p>
	</td>
</tr>
<tr>
	<td>
		<video src="/videos/psycho_kettle_Shinkai.mp4" controls="controls" style="max-width: 100%; display: block; margin-left: auto; margin-right: auto;">your browser does not support the video tag 
		</video>
		<p style="text-align: center; margin-top: 5px; margin-bottom: 5px;">Shinkai Style</p>
	</td>
	<td>
		<video src="/videos/psycho_kettle_Hayao.mp4" controls="controls" style="max-width: 100%; display: block; margin-left: auto; margin-right: auto;">your browser does not support the video tag 
		</video>
		<p style="text-align: center; margin-top: 5px; margin-bottom: 5px;">Hayao Style</p>
	</td>
	<td>
		<video src="/videos/psycho_kettle_Hosoda.mp4" controls="controls" style="max-width: 100%; display: block; margin-left: auto; margin-right: auto;">your browser does not support the video tag 
		</video>
		<p style="text-align: center; margin-top: 5px; margin-bottom: 5px;">Hosoda Style</p>
	</td>
</tr>
</table>
<h2 id="more-shinkai-results"><a class="header-anchor" href="#more-shinkai-results">§</a>More Shinkai results</h2>
<table>
<tr>
	<td>
		<video src="/videos/1236.MP4" controls="controls" style="max-width: 100%; display: block; margin-left: auto; margin-right: auto;">your browser does not support the video tag 
		</video>
		<p style="text-align: center; margin-top: 5px; margin-bottom: 5px;">BeachByDrone</p>
	</td>
	<td>
		<video src="/videos/1247.MP4" controls="controls" style="max-width: 100%; display: block; margin-left: auto; margin-right: auto;">your browser does not support the video tag 
		</video>
		<p style="text-align: center; margin-top: 5px; margin-bottom: 5px;">CloudsTimelapse</p>
	</td>
	<td>
		<video src="/videos/1238.MP4" controls="controls" style="max-width: 100%; display: block; margin-left: auto; margin-right: auto;">your browser does not support the video tag 
		</video>
		<p style="text-align: center; margin-top: 5px; margin-bottom: 5px;">Cat</p>
	</td>
</tr>
<tr>
	<td>
		<video src="/videos/1242.MP4" controls="controls" style="max-width: 100%; display: block; margin-left: auto; margin-right: auto;">your browser does not support the video tag 
		</video>
		<p style="text-align: center; margin-top: 5px; margin-bottom: 5px;">MotherAndSon</p>
	</td>
	<td>
		<video src="/videos/1245.MP4" controls="controls" style="max-width: 100%; display: block; margin-left: auto; margin-right: auto;">your browser does not support the video tag 
		</video>
		<p style="text-align: center; margin-top: 5px; margin-bottom: 5px;">WomanWorking</p>
	</td>
	<td>
		<video src="/videos/1248.MP4" controls="controls" style="max-width: 100%; display: block; margin-left: auto; margin-right: auto;">your browser does not support the video tag 
		</video>
		<p style="text-align: center; margin-top: 5px; margin-bottom: 5px;">FatherAndSon</p>
	</td>
</tr>
<tr>
	<td>
		<video src="/videos/1243.MP4" controls="controls" style="max-width: 100%; display: block; margin-left: auto; margin-right: auto;">your browser does not support the video tag 
		</video>
		<p style="text-align: center; margin-top: 5px; margin-bottom: 5px;">SanFrancisco</p>
	</td>
	<td>
		<video src="/videos/1249.MP4" controls="controls" style="max-width: 100%; display: block; margin-left: auto; margin-right: auto;">your browser does not support the video tag 
		</video>
		<p style="text-align: center; margin-top: 5px; margin-bottom: 5px;">WestminsterBridge</p>
	</td>
	<td>
		<video src="/videos/1250.MP4" controls="controls" style="max-width: 100%; display: block; margin-left: auto; margin-right: auto;">your browser does not support the video tag 
		</video>
		<p style="text-align: center; margin-top: 5px; margin-bottom: 5px;">TajMahal</p>
	</td>
</tr>
</table>
<h1>Experiments and ideas we tried</h1>
<h2 id="choosing-between-colorization-models"><a class="header-anchor" href="#choosing-between-colorization-models">§</a>Choosing between Colorization Models</h2>
<p>We also tried another colorization model, for example an implementation of GAN model based on<sup class="footnote-ref"><a href="#fn10" id="fnref10">[10]</a></sup>. And we eventually chose DeOldify as our model because it renders more vivid colors, thus will be better for animation in next phase.</p>
<p><img src="https://paper-attachments.dropbox.com/s_BB923EE403F4FA0B2AC5356A2ED69F4A8FC578950CD21EC48207217EE95E0525_1556514797347_psycho1257.jpg" alt="Results of Using Johnson’s Network"><br>
<img src="https://paper-attachments.dropbox.com/s_BB923EE403F4FA0B2AC5356A2ED69F4A8FC578950CD21EC48207217EE95E0525_1556514808357_psycho1257.jpg" alt="Results of Using DeOldify"></p>
<h2 id="tune-deoldify"><a class="header-anchor" href="#tune-deoldify">§</a>Tune DeOldify</h2>
<p>Previously, we tried to do some transfer learning on DeOldify with video frames to improve its capability to work on video colorization. But the training failed because of “cuda is out of memory” on Google Cloud Platform. Therefore, we stayed with the pre-trained model.</p>
<h2 id="gan-for-stabilization"><a class="header-anchor" href="#gan-for-stabilization">§</a>GAN for Stabilization</h2>
<p>As discussed with Professor Lim, we thought about adding a stabilization structure to CartoonGAN and a stabilization discriminator. We enriched our original dataset with its consecutive frames (5 frames, 10 frames, and 20 frames), we calculated pixal-based squared distance between every two consecutive frames to make sure there are no scene-cut inside our dataset(Afterwards, we realized that we shouldn’t do that, we manually made our dataset more biased). We utilized a dual-discriminator structure<sup class="footnote-ref"><a href="#fn11" id="fnref11">[11]</a></sup>, one is the same as CartoonGAN, to determine whether the frame-by-frame input is a real cartoon and the otherone is used to determine whether the sequence input is a consecutive cartoon using short-term and long-term loss<sup class="footnote-ref"><a href="#fn6" id="fnref6:3">[6]</a></sup><sup class="footnote-ref"><a href="#fn12" id="fnref12">[12]</a></sup>. However, this GAN is incredible harder to train, we downsize our batch size from 6 to 3 to 1, and reduce consecutive frames from 5 to 3, then we managed to get rid of Cuda’s out of memory error. And training speed is very slow(couldn’t finish even one epoch in a day), and still had many hyper-parameter to tune. It seemed unworthy to finish it to check if it works and tune everything, therefore we dropped this idea.</p>
<p><img src="https://paper-attachments.dropbox.com/s_33BC8E3177835D6147C233F29AEE7F019BDC905E916E7DC9C92C5E436A454360_1556606686354_2.png" alt=""></p>
<h1>References</h1>
<hr class="footnotes-sep">
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p>Han Zhang et al. “Self-Attention Generative Adversarial Networks”. In: arXiv e-prints, arXiv:1805.08318 (May 2018), arXiv:1805.08318. arXiv: 1805.08318 [<a href="http://stat.ML" target="_blank" rel="external">stat.ML</a>]. <a href="#fnref1" class="footnote-backref">↩</a></p>
</li>
<li id="fn2" class="footnote-item"><p>Karras, Tero, Timo Aila, Samuli Laine, and Jaakko Lehtinen. “Progressive growing of gans for improved quality, stability, and variation.” <em>arXiv preprint arXiv:1710.10196</em> (2017). <a href="#fnref2" class="footnote-backref">↩</a></p>
</li>
<li id="fn3" class="footnote-item"><p>Heusel, Martin, Hubert Ramsauer, Thomas Unterthiner, Bernhard Nessler, Günter Klambauer, and Sepp Hochreiter. “Gans trained by a two time-scale update rule converge to a nash equilibrium.” <em>arXiv preprint arXiv:1706.08500</em> 12, no. 1 (2017). <a href="#fnref3" class="footnote-backref">↩</a></p>
</li>
<li id="fn4" class="footnote-item"><p>Yang Chen, Yu-Kun Lai, and Yong-Jin Liu. “CartoonGAN: Generative Adversarial Networks for Photo Cartoonization”. In: 2018 IEEE/CVF Conference on Computer Vision and Pattern Recognition (2018), pp. 9465– 9474. <a href="#fnref4" class="footnote-backref">↩</a></p>
</li>
<li id="fn5" class="footnote-item"><p>Canny, John. “A computational approach to edge detection.” In <em>Readings in computer vision</em>, pp. 184-203. Morgan Kaufmann, 1987. <a href="#fnref5" class="footnote-backref">↩</a></p>
</li>
<li id="fn6" class="footnote-item"><p>Wei-Sheng Lai et al. “Learning Blind Video Temporal Consistency”. In: CoRR abs/1808.00449 (2018). arXiv: 1808.00449. url: <a href="http://arxiv.org/abs/1808" target="_blank" rel="external">http://arxiv.org/abs/1808</a>. 00449. <a href="#fnref6" class="footnote-backref">↩</a> <a href="#fnref6:1" class="footnote-backref">↩</a> <a href="#fnref6:2" class="footnote-backref">↩</a> <a href="#fnref6:3" class="footnote-backref">↩</a></p>
</li>
<li id="fn7" class="footnote-item"><p><a href="https://davischallenge.org/index.html" target="_blank" rel="external">https://davischallenge.org/index.html</a> <a href="#fnref7" class="footnote-backref">↩</a></p>
</li>
<li id="fn8" class="footnote-item"><p><a href="https://www.videvo.net" target="_blank" rel="external">https://www.videvo.net</a> <a href="#fnref8" class="footnote-backref">↩</a></p>
</li>
<li id="fn9" class="footnote-item"><p>Xingjian, S., Chen, Z., Wang, H., Yeung, D.Y., Wong, W.K., Woo, W.C.: Convolutional LSTM network: A machine learning approach for precipitation nowcasting. In: NIPS (2015) <a href="#fnref9" class="footnote-backref">↩</a></p>
</li>
<li id="fn10" class="footnote-item"><p>Johnson, Justin, Alexandre Alahi, and Li Fei-Fei. “Perceptual losses for real-time style transfer and super-resolution.” In <em>European conference on computer vision</em>, pp. 694-711. Springer, Cham, 2016. <a href="#fnref10" class="footnote-backref">↩</a></p>
</li>
<li id="fn11" class="footnote-item"><p>Nguyen, Tu, Trung Le, Hung Vu, and Dinh Phung. “Dual discriminator generative adversarial nets.” In <em>Advances in Neural Information Processing Systems</em>, pp. 2670-2680. 2017. <a href="#fnref11" class="footnote-backref">↩</a></p>
</li>
<li id="fn12" class="footnote-item"><p>Ruder, Manuel, Alexey Dosovitskiy, and Thomas Brox. “Artistic style transfer for videos and spherical images.” <em>International Journal of Computer Vision</em> 126, no. 11 (2018): 1199-1219. <a href="#fnref12" class="footnote-backref">↩</a></p>
</li>
</ol>
</section>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/09/05/Summer-Lec-4-5/" itemprop="url">
                  Summer Lec 4-5
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2018-09-05T09:36:38-07:00" content="2018-09-05">
              2018-09-05
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Program/" itemprop="url" rel="index">
                    <span itemprop="name">Program</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Program/Leetcode/" itemprop="url" rel="index">
                    <span itemprop="name">Leetcode</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2018/09/05/Summer-Lec-4-5/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/09/05/Summer-Lec-4-5/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2018/09/05/Summer-Lec-4-5/" class="leancloud_visitors" data-flag-title="Summer Lec 4-5">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="summer-lec-4-special-data-structures"><a class="header-anchor" href="#summer-lec-4-special-data-structures">§</a>Summer Lec 4: Special Data Structures</h3>
<h4 id="problem"><a class="header-anchor" href="#problem">§</a>problem</h4>
<h5 id="flatten-2d-vector"><a class="header-anchor" href="#flatten-2d-vector">§</a><a href="https://leetcode.com/problems/flatten-2d-vector" target="_blank" rel="external">Flatten 2D Vector</a></h5>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Vector2D &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; vec2d;</span><br><span class="line">    <span class="keyword">int</span> rowIdx = <span class="number">0</span>, colIdx = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Vector2D(<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt;&amp; vec2d) &#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;vec2d = vec2d;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span><br><span class="line">    OR </span><br><span class="line">    vector&lt;vector&lt;int&gt;&gt;::iterator i, iEnd;</span><br><span class="line">    vector&lt;int&gt;::iterator j;</span><br><span class="line">    Vector2D(vector&lt;vector&lt;int&gt;&gt;&amp; vec2d) &#123;</span><br><span class="line">        i = vec2d.begin();</span><br><span class="line">        iEnd = vec2d.end();</span><br><span class="line">    &#125;</span><br><span class="line">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!hasNext())</span><br><span class="line">            return <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            return vec2d[rowIdx][colIdx++];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (rowIdx &lt; vec2d.size()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (colIdx &lt; vec2d[rowIdx].size())</span><br><span class="line">                return <span class="literal">true</span>;</span><br><span class="line">            colIdx = <span class="number">0</span>;</span><br><span class="line">            ++rowIdx;</span><br><span class="line">        &#125;</span><br><span class="line">        return <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Your Vector2D object will be instantiated and called as such:</span><br><span class="line"> * Vector2D i(vec2d);</span><br><span class="line"> * while (i.hasNext()) cout &lt;&lt; i.next();</span><br><span class="line"> */</span></span><br></pre></td></tr></table></figure>
<h6 id="follow-up"><a class="header-anchor" href="#follow-up">§</a>Follow up</h6>
<p>Java:</p>
<p>runtiome Exception/unchecked, eg. <code>throw new NoSuchElementException()</code></p>
<p>checked Exception -&gt; catch or declare</p>
<p>Uber interview, <strong>Implement Token Bucket</strong>. eg.sleep throws InterruptedException</p>
<p>remove()</p>
<h6 id="iterator-design-pattern-in-java"><a class="header-anchor" href="#iterator-design-pattern-in-java">§</a>Iterator Design Pattern in Java</h6>
<p>implement next(), hasNext(), remove()</p>
<p>good for <strong>Lazy Loading</strong>: File I/O, DAO, Big Data</p>
<h5 id="pancake-sort"><a class="header-anchor" href="#pancake-sort">§</a>pancake sort</h5>
<h5 id="max-chunks-to-make-sorted-max-chunks-to-make-sorted-ii"><a class="header-anchor" href="#max-chunks-to-make-sorted-max-chunks-to-make-sorted-ii">§</a><a href="https://leetcode.com/problems/max-chunks-to-make-sorted" target="_blank" rel="external">Max Chunks To Make Sorted</a>, <a href="https://leetcode.com/problems/max-chunks-to-make-sorted-ii" target="_blank" rel="external">Max Chunks To Make Sorted II</a></h5>
<h6 id="shallow-copy-deep-copy"><a class="header-anchor" href="#shallow-copy-deep-copy">§</a>shallow copy / deep copy</h6>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//sol 2</span></span><br><span class="line">        <span class="comment">// find (0..n)max/(n..0)min, if at this position, max &lt;= min -&gt;add chunk</span></span><br><span class="line">        <span class="comment">// max &lt; min -&gt;must add chunk, max == min-&gt;can add</span></span><br><span class="line">        <span class="comment">// a0[p0]a1[p1]a2...[pn-2]pn-1</span></span><br><span class="line">        <span class="keyword">int</span> n = arr.size(), res = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; maxN(n), minN(n);</span><br><span class="line">        <span class="keyword">int</span> maxn = maxN[<span class="number">0</span>] = arr[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">int</span> minn = minN[n<span class="number">-2</span>] = arr[n<span class="number">-1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n<span class="number">-1</span>; ++i)</span><br><span class="line">            maxN[i] = maxn = max(maxn, arr[i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n<span class="number">-3</span>; i &gt;= <span class="number">0</span>; --i)</span><br><span class="line">            minN[i] = minn = min(minn, arr[i+<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n<span class="number">-1</span>; ++i)</span><br><span class="line">            <span class="keyword">if</span> (maxN[i]&lt;=minN[i])</span><br><span class="line">                ++res;</span><br></pre></td></tr></table></figure>
<h5 id="76-minimum-window-substring"><a class="header-anchor" href="#76-minimum-window-substring">§</a><a href="https://leetcode.com/problems/minimum-window-substring/description/" target="_blank" rel="external">76. Minimum Window Substring</a></h5>
<h5 id="380-insert-delete-getrandom-o-1-381-insert-delete-getrandom-o-1-duplicates-allowed"><a class="header-anchor" href="#380-insert-delete-getrandom-o-1-381-insert-delete-getrandom-o-1-duplicates-allowed">§</a><a href="https://leetcode.com/problems/insert-delete-getrandom-o1" target="_blank" rel="external">380. Insert Delete GetRandom O(1)</a>, <a href="https://leetcode.com/problems/insert-delete-getrandom-o1-duplicates-allowed" target="_blank" rel="external">381. Insert Delete GetRandom O(1) - Duplicates allowed</a></h5>
<p>Load Balancer: Randomly choose a server. Runder Robin</p>
<p>Array: O(1) getRandom</p>
<p>HashMap: O(1) insert and remove</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; nums;</span><br><span class="line"><span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; <span class="built_in">map</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span>&lt;pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;&gt; nums; <span class="comment">//&lt;num,map-idx&gt;</span></span><br><span class="line"><span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; <span class="built_in">map</span>; <span class="comment">//num, nums-idxs</span></span><br></pre></td></tr></table></figure>
<h3 id="summer-lec-5-dp-airbnb"><a class="header-anchor" href="#summer-lec-5-dp-airbnb">§</a>Summer Lec 5: DP &amp; Airbnb</h3>
<h4 id="dynamic-programming"><a class="header-anchor" href="#dynamic-programming">§</a>Dynamic programming</h4>
<ol>
<li>Deduction formula</li>
<li>Initialization</li>
<li>Space improvement</li>
</ol>
<h4 id="problem-v2"><a class="header-anchor" href="#problem-v2">§</a>problem</h4>
<h5 id="edit-distance"><a class="header-anchor" href="#edit-distance">§</a><a href="https://leetcode.com/problems/edit-distance" target="_blank" rel="external">Edit Distance</a></h5>
<p>#####Airbnb interview questions</p>
<ul>
<li>
<p><a href="http://www.lintcode.com/en/problem/k-edit-distance/" target="_blank" rel="external">K Edit Distance</a>, <a href="https://quip.com/-/blob/XBPAAAT9D5M/l8NmDpf077cF-xqkUCxyiA?s=E7FmAsFC3F2S&amp;name=KEditDistance.java" target="_blank" rel="external">KEditDistance.java</a>: Trie + DP</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> TrieNode&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">vector</span>&lt;TrieNode*&gt; child;</span><br><span class="line">	<span class="keyword">bool</span> isEnd;</span><br><span class="line">	<span class="built_in">string</span> word;</span><br><span class="line">	TrieNode()&#123;</span><br><span class="line">		child.resize(<span class="number">26</span>);</span><br><span class="line">		isEnd = <span class="literal">false</span>;</span><br><span class="line">		word = <span class="string">""</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	~TrieNode()&#123;</span><br><span class="line">		<span class="keyword">for</span> (TrieNode *p : child)</span><br><span class="line">			<span class="keyword">if</span> (p)</span><br><span class="line">				<span class="keyword">delete</span> p;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> Solution &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="built_in">string</span>&amp; word, TrieNode* root)</span></span>&#123;</span><br><span class="line">		TrieNode* cur = root;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">char</span> c:word)&#123;</span><br><span class="line">			<span class="keyword">int</span> i = c - <span class="string">'a'</span>;</span><br><span class="line">            <span class="keyword">if</span> (cur-&gt;child[i] == <span class="literal">NULL</span>) </span><br><span class="line">                cur-&gt;child[i] = new TrieNode();</span><br><span class="line">            cur = cur-&gt;child[i];</span><br><span class="line">		&#125;</span><br><span class="line">		cur-&gt;isEnd = <span class="literal">true</span>;</span><br><span class="line">		cur-&gt;word = word;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(TrieNode* cur, <span class="built_in">string</span>&amp; target, <span class="keyword">int</span> k, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; dp, <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;&amp; res)</span></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> l = target.length();</span><br><span class="line">		<span class="keyword">if</span> (cur-&gt;isEnd &amp;&amp; dp[l] &lt;= k)</span><br><span class="line">			res.push_back(cur-&gt;word);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; nextdp(l+<span class="number">1</span>);</span><br><span class="line">		nextdp[<span class="number">0</span>] = dp[<span class="number">0</span>]+<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; ++i)</span><br><span class="line">			<span class="keyword">if</span> (cur-&gt;child[i])&#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= l; ++j)</span><br><span class="line">				    <span class="comment">//nextdp[j]: target j-1 ~ trie with c</span></span><br><span class="line">					<span class="keyword">if</span> (target[j<span class="number">-1</span>]-<span class="string">'a'</span> == i)</span><br><span class="line">				        <span class="comment">//dp[j-1]: taret j-2 ~ trie without c</span></span><br><span class="line">						nextdp[j] = dp[j<span class="number">-1</span>];</span><br><span class="line">					<span class="keyword">else</span></span><br><span class="line">					    <span class="comment">//taret j-2 ~ trie without c ; j-1 ~ without c, j-2 ~ with c</span></span><br><span class="line">					    <span class="comment">//add c; replace one letter, convert c ~ target[j-1]; add target[j-1]</span></span><br><span class="line">					    nextdp[j] = min(min(dp[j<span class="number">-1</span>],dp[j]),nextdp[j<span class="number">-1</span>])+<span class="number">1</span>;</span><br><span class="line">				dfs(cur-&gt;child[i], target, k, nextdp, res);</span><br><span class="line">			&#125;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * @param words: a set of stirngs</span><br><span class="line">     * @param target: a target string</span><br><span class="line">     * @param k: An integer</span><br><span class="line">     * @return: output all the strings that meet the requirements</span><br><span class="line">     */</span></span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; kDistance(<span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; &amp;words, <span class="built_in">string</span> &amp;target, <span class="keyword">int</span> k) &#123;</span><br><span class="line">        TrieNode* root = new TrieNode();</span><br><span class="line">		<span class="keyword">int</span> l = target.length();</span><br><span class="line">		<span class="keyword">for</span> (<span class="built_in">string</span>&amp; word:words)&#123;</span><br><span class="line">			<span class="comment">//prune</span></span><br><span class="line">			<span class="comment">//if (word.length() &lt;= l+k &amp;&amp; word.length() &gt;= l-k)</span></span><br><span class="line">				insert(word,root);</span><br><span class="line">		    </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; dp(l+<span class="number">1</span>);</span><br><span class="line">		iota(dp.begin(),dp.end(),<span class="number">0</span>);</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; res;</span><br><span class="line">        dfs(root, target, k, dp, res);</span><br><span class="line">		<span class="keyword">delete</span> root;</span><br><span class="line">		return res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
<li>
<p><a href="https://leetcode.com/problems/cheapest-flights-within-k-stops/description/" target="_blank" rel="external">Cheapest Flights within K Stops</a>, <a href="https://quip.com/-/blob/XBPAAAT9D5M/9QjX6vRnAXNi0rjqzNHuMQ?s=E7FmAsFC3F2S&amp;name=CheapestFlightsWithinKStops.java" target="_blank" rel="external">CheapestFlightsWithinKStops.java</a></p>
<ul>
<li>Follow up: output the route</li>
</ul>
</li>
</ul>
<h5 id="221-maximal-square"><a class="header-anchor" href="#221-maximal-square">§</a><a href="https://leetcode.com/problems/maximal-square" target="_blank" rel="external">221. Maximal Square</a></h5>
<p><img src="https://raw.githubusercontent.com/yuzhoujr/spazzatura/master/img_box/221.jpeg" alt="DP"></p>
<h5 id="85-maximal-rectangle-764-largest-plus-sign"><a class="header-anchor" href="#85-maximal-rectangle-764-largest-plus-sign">§</a><a href="https://leetcode.com/problems/maximal-rectangle/description/" target="_blank" rel="external">85. Maximal Rectangle</a>, <a href="https://leetcode.com/problems/largest-plus-sign/description/" target="_blank" rel="external">764. Largest Plus Sign</a></h5>
<h4 id="stack-string-basic-calculator"><a class="header-anchor" href="#stack-string-basic-calculator">§</a>stack/string : Basic Calculator</h4>
<h5 id="224-basic-calculator-227-basic-calculator-ii"><a class="header-anchor" href="#224-basic-calculator-227-basic-calculator-ii">§</a><a href="https://leetcode.com/problems/basic-calculator/description/" target="_blank" rel="external">224. Basic Calculator</a>, <a href="https://leetcode.com/problems/basic-calculator-ii/description/" target="_blank" rel="external">227. Basic Calculator II</a></h5>
<h5 id="772-basic-calculator-iii"><a class="header-anchor" href="#772-basic-calculator-iii">§</a><a href="https://leetcode.com/problems/basic-calculator-iii/description/" target="_blank" rel="external">772. Basic Calculator III</a></h5>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Solution &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//res pre op num/() ch</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">calculate</span><span class="params">(<span class="built_in">string</span> s)</span> </span>&#123;</span><br><span class="line">        s = <span class="string">"+("</span>+s+<span class="string">")++"</span>;</span><br><span class="line">        <span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; stRes;</span><br><span class="line">        <span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; stPre; <span class="comment">//pre num</span></span><br><span class="line">        <span class="built_in">stack</span>&lt;<span class="keyword">char</span>&gt; stOp;</span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">0</span>, pre = <span class="number">0</span>, num = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">char</span> op = <span class="string">'+'</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">char</span> ch : s)&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">isdigit</span>(ch))</span><br><span class="line">                num = num*<span class="number">10</span> + ch-<span class="string">'0'</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (ch!=<span class="string">' '</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span> (ch == <span class="string">'('</span>)&#123;</span><br><span class="line">                    stRes.push(res), res = <span class="number">0</span>;</span><br><span class="line">                    stPre.push(pre), pre = <span class="number">0</span>;</span><br><span class="line">                    stOp.push(op), op = <span class="string">'+'</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (ch ==<span class="string">')'</span>)&#123;</span><br><span class="line">                    <span class="keyword">if</span> (op==<span class="string">'+'</span> || op==<span class="string">'-'</span>)</span><br><span class="line">                        num = res + pre + (<span class="string">','</span>-op)*num;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (op==<span class="string">'*'</span>)</span><br><span class="line">                        num = res + pre*num;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (op==<span class="string">'/'</span>)</span><br><span class="line">                        num = res + pre/num;</span><br><span class="line">                    res = stRes.top(), stRes.pop();</span><br><span class="line">                    pre = stPre.top(), stPre.pop();</span><br><span class="line">                    op = stOp.top(), stOp.pop();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (op==<span class="string">'+'</span> || op ==<span class="string">'-'</span>)&#123;</span><br><span class="line">                        res += pre;</span><br><span class="line">                        pre = (<span class="string">','</span>-op)*num;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (op==<span class="string">'*'</span>)</span><br><span class="line">                        pre *= num;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (op==<span class="string">'/'</span>)</span><br><span class="line">                        pre /= num;</span><br><span class="line"></span><br><span class="line">                    op = ch;</span><br><span class="line">                    num = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//cout &lt;&lt; res &lt;&lt;","&lt;&lt; pre &lt;&lt;","&lt;&lt; num &lt;&lt;","&lt;&lt; op &lt;&lt;endl;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h5 id="770-basic-calculator-iv-undo"><a class="header-anchor" href="#770-basic-calculator-iv-undo">§</a><a href="https://leetcode.com/problems/basic-calculator-iv/description/" target="_blank" rel="external">770. Basic Calculator IV</a> - undo</h5>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/08/31/Summer-Lec-1-3/" itemprop="url">
                  Summer Lec 1-3
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2018-08-31T23:33:28-07:00" content="2018-08-31">
              2018-08-31
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Program/" itemprop="url" rel="index">
                    <span itemprop="name">Program</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Program/Leetcode/" itemprop="url" rel="index">
                    <span itemprop="name">Leetcode</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2018/08/31/Summer-Lec-1-3/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/08/31/Summer-Lec-1-3/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2018/08/31/Summer-Lec-1-3/" class="leancloud_visitors" data-flag-title="Summer Lec 1-3">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="lec-1-trie-prefix-tree"><a class="header-anchor" href="#lec-1-trie-prefix-tree">§</a>Lec 1 - Trie / Prefix Tree</h3>
<h4 id="materials"><a class="header-anchor" href="#materials">§</a>Materials</h4>
<p><a href="https://en.wikipedia.org/wiki/Trie" target="_blank" rel="external">https://en.wikipedia.org/wiki/Trie</a></p>
<p><a href="https://www.geeksforgeeks.org/trie-insert-and-search/" target="_blank" rel="external">https://www.geeksforgeeks.org/trie-insert-and-search/</a></p>
<p><a href="https://pan.baidu.com/s/1c3Bs8la" target="_blank" rel="external">PPT</a></p>
<h4 id="tries"><a class="header-anchor" href="#tries">§</a>Tries</h4>
<ul>
<li>
<p>Variable length keys</p>
</li>
<li>
<p>The decision on what path to follow is taken based on portion of the key</p>
</li>
<li>
<p>Static environment, fast retrieval but large space overhead</p>
</li>
<li>
<p>Applications: dictionaries, text searching</p>
</li>
<li>
<p>Trade space for runtime</p>
</li>
<li>
<p>Costly operation to build Trie: assume updating or rebuilding is rare</p>
</li>
</ul>
<h4 id="problem"><a class="header-anchor" href="#problem">§</a>Problem</h4>
<h5 id="implement-trie-prefix-tree"><a class="header-anchor" href="#implement-trie-prefix-tree">§</a><a href="https://leetcode.com/problems/implement-trie-prefix-tree/" target="_blank" rel="external">Implement Trie (Prefix Tree)</a></h5>
<ul>
<li>
<p>Use Array/HashMap</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TrieNode</span></span>&#123;</span><br><span class="line">    <span class="comment">//boolean isWord;</span></span><br><span class="line">    <span class="comment">//String word; //pointer to word</span></span><br><span class="line">    List&lt;String&gt; words; <span class="comment">//contains pointers to passing words</span></span><br><span class="line">    <span class="comment">//TrieNode[] children;</span></span><br><span class="line">    Map&lt;Character, TrieNode&gt; children;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TrieNode</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.children = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>In trie implementation, we should confirm that we have frequent search but less frequent add operation</p>
</li>
<li>
<p>谷歌变种</p>
<ul>
<li>compress: apply, apple; a-&gt;p-&gt;p-&gt;l-&gt;… =&gt; app-&gt;…</li>
<li>compound word: cat, copy, copycat; root-&gt;cat, root-&gt;copy-&gt;cat=&gt; copy -back-&gt; cat</li>
</ul>
</li>
</ul>
<h5 id="longest-word-in-dictionary"><a class="header-anchor" href="#longest-word-in-dictionary">§</a><a href="https://leetcode.com/problems/longest-word-in-dictionary/" target="_blank" rel="external">Longest Word in Dictionary</a></h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> index = -<span class="number">1</span>; <span class="comment">//4bits, save space than pointer(use string, 4bits-32 / 8bits-64) </span></span><br><span class="line"><span class="comment">/*</span><br><span class="line">=&gt; space improvement: boolean isWord; </span><br><span class="line">public String dfs(TrieNode cur, StringBuilder temp, String[] ans)</span><br><span class="line">temp.append(entry.getKey());</span><br><span class="line">dfs</span><br><span class="line">temp.deleteCharAt(temp.length()-1);// restore </span><br><span class="line">*/</span></span><br><span class="line">cur = cur.children.computeIfAbsent(c, k -&gt; <span class="keyword">new</span> TrieNode()); <span class="comment">//if c not exist, return k</span></span><br></pre></td></tr></table></figure>
<h5 id="runtime"><a class="header-anchor" href="#runtime">§</a>Runtime</h5>
<p>Trie1， boolean isWord， 需要StringBuilder，平均每个node有k child，有l层</p>
<p>Tire2， Stirng word，same runtime</p>
<p>Tire3，List<string> words.，最耗空间，runtime最快，不需要dfs</string></p>
<h5 id="prefix-and-suffix-search"><a class="header-anchor" href="#prefix-and-suffix-search">§</a><a href="https://leetcode.com/problems/prefix-and-suffix-search/" target="_blank" rel="external">Prefix and Suffix Search</a></h5>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">apple</span><br><span class="line">-&gt;a*-&gt;ap*-&gt;...(n-1)</span><br><span class="line">-&gt;*e-&gt;*le-&gt;...</span><br><span class="line">-&gt;a*e</span><br><span class="line">	-&gt;ap*e-&gt;app*e-&gt;...(n-2)</span><br><span class="line">    -&gt;a*le-&gt;a*ple-&gt;...</span><br><span class="line">    -&gt;ap*le</span><br><span class="line">    	-&gt;...</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">space:</span><br><span class="line">n is avg length of one word O(n)</span><br><span class="line">only prefix/only suffix: (n-1) +  n-3 + … -&gt; O(n^2)</span><br><span class="line">prefix+suffix: O(n)</span><br><span class="line">m words with avg length of n</span><br><span class="line">worst case =&gt; no overlapping =&gt; O(m*n^2)</span><br><span class="line"></span><br><span class="line">本题，Trie 的每一个 TrieNode 对应的是 Prefix+Suffix 的一种组合并不是某一个word或几个words</span><br></pre></td></tr></table></figure>
<p><a href="https://leetcode.com/problems/map-sum-pairs/" target="_blank" rel="external">https://leetcode.com/problems/map-sum-pairs/</a></p>
<p><a href="https://leetcode.com/problems/word-search-ii/" target="_blank" rel="external">https://leetcode.com/problems/word-search-ii/</a></p>
<h3 id="lec-2-3-graph-graph-search-union-find-topological-sort"><a class="header-anchor" href="#lec-2-3-graph-graph-search-union-find-topological-sort">§</a>Lec 2/3 - Graph: Graph Search, Union Find &amp; Topological Sort</h3>
<h4 id="materials-v2"><a class="header-anchor" href="#materials-v2">§</a>Materials</h4>
<p><a href="https://www.geeksforgeeks.org/graph-data-structure-and-algorithms/" target="_blank" rel="external">Graph: Data Structure and Algorithms</a></p>
<p><a href="https://www.geeksforgeeks.org/graph-and-its-representations/" target="_blank" rel="external">Graph and Its Representations</a></p>
<p><a href="https://www.geeksforgeeks.org/topological-sorting/" target="_blank" rel="external">Topological Sorting</a></p>
<h4 id="graph"><a class="header-anchor" href="#graph">§</a>Graph</h4>
<p>edges, Adjacency Matrix, <strong>Adjacency List</strong> (use map)</p>
<h4 id="problem-v2"><a class="header-anchor" href="#problem-v2">§</a>Problem</h4>
<h5 id="谷歌难题：maximum-number-of-edges-in-graph-without-a-cycle"><a class="header-anchor" href="#谷歌难题：maximum-number-of-edges-in-graph-without-a-cycle">§</a>谷歌难题：maximum number of edges in graph without a cycle</h5>
<p>undirected graph, n vertexes: n-1</p>
<p>directed graph, n vertexes: n-1 + n-2 + … + 1 = (n-1)n/2</p>
<p><a href="https://leetcode.com/problems/number-of-connected-components-in-an-undirected-graph" target="_blank" rel="external">Number of Connected Components in an Undirected Graph</a></p>
<p>//bfs. iterate: use heap</p>
<p>//dfs. recursive: stack overflow</p>
<p>//union-find: less memory</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//dfs | bfs</span></span><br><span class="line"><span class="keyword">class</span> Solution &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt;&amp; adjL, <span class="built_in">vector</span>&lt;<span class="keyword">bool</span>&gt;&amp; visited, <span class="keyword">int</span> cur, <span class="keyword">int</span>&amp; res)</span></span>&#123;</span><br><span class="line">        visited[cur] = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> v : adjL[cur])</span><br><span class="line">            <span class="keyword">if</span> (!visited[v])</span><br><span class="line">                dfs(adjL, visited, v, res);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">countComponents</span><span class="params">(<span class="keyword">int</span> n, <span class="built_in">vector</span>&lt;pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&gt;&amp; edges)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//adjlist</span></span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; adjL = <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt;(n,vector&lt;int&gt;(<span class="number">0</span>));</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> edge:edges)&#123;</span><br><span class="line">            adjL[edge.first].push_back(edge.second);</span><br><span class="line">            adjL[edge.second].push_back(edge.first);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">bool</span>&gt; visited = <span class="built_in">vector</span>&lt;<span class="keyword">bool</span>&gt;(n, false);</span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//dfs</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">            <span class="keyword">if</span> (!visited[i])</span><br><span class="line">                dfs(adjL, visited, i, ++res);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//bfs</span></span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">bool</span>&gt; visited = <span class="built_in">vector</span>&lt;<span class="keyword">bool</span>&gt;(n, false);</span><br><span class="line">        <span class="keyword">int</span> cur, visitedN = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">        <span class="keyword">while</span> (!q.empty() || visitedN!=n)&#123;</span><br><span class="line">            <span class="keyword">if</span> (q.empty())&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++ i)</span><br><span class="line">                    <span class="keyword">if</span> (!visited[i])&#123;</span><br><span class="line">                        cur = i;</span><br><span class="line">                        ++ res;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                cur = q.front();</span><br><span class="line">                q.pop();</span><br><span class="line">                <span class="keyword">if</span> (visited[cur])</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; </span><br><span class="line">            visited[cur] = <span class="literal">true</span>, ++visitedN;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> v : adjL[cur])</span><br><span class="line">                q.push(v);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        return res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//union-find</span></span><br><span class="line"><span class="keyword">class</span> Solution &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; par, <span class="keyword">int</span> cur)</span></span>&#123;</span><br><span class="line">        return par[cur]==cur ? cur : par[cur] = find(par, par[cur]); <span class="comment">//compress path</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">countComponents</span><span class="params">(<span class="keyword">int</span> n, <span class="built_in">vector</span>&lt;pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&gt;&amp; edges)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//union-find</span></span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; par(n);</span><br><span class="line">        iota(begin(par), end(par), <span class="number">0</span>); <span class="comment">//0..n-1</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> edge:edges)&#123;</span><br><span class="line">            <span class="keyword">int</span> u = find(par, edge.first), v = find(par, edge.second);</span><br><span class="line">            par[u] = v;</span><br><span class="line">            n -= (v!=u);</span><br><span class="line">        &#125; </span><br><span class="line">        return n;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h5 id="clone-graph"><a class="header-anchor" href="#clone-graph">§</a><a href="https://leetcode.com/problems/clone-graph" target="_blank" rel="external">Clone Graph</a></h5>
<p><a href="https://leetcode.com/problems/evaluate-division/" target="_blank" rel="external">Evalualte Division</a></p>
<p>FB&amp;GG high frequency. 谷歌Variation: Currency Exchange</p>
<ol>
<li>Process equations and values to build graph<br>
numMap: map&lt;string, map&lt;string, double&gt;&gt;<br>
visitedSet: set&lt;string&gt;<br>
visitKey = num + “:” + denom //如果分子分母有:，这里handle</li>
<li>Process query by the graph</li>
</ol>
<p>Follow Up: currency rate update-&gt;concurrency同步-&gt;<strong>synchronization/multi-thread</strong></p>
<p><strong>ConcurrentHashMap</strong> - <a href="https://quip.com/aCoTAb1SQfnD" target="_blank" rel="external">https://quip.com/aCoTAb1SQfnD</a> - Lec 16: Multithreading (English)</p>
<p>CopyOnWroteMap (suit for write Rarely)</p>
<h5 id="topological-sort"><a class="header-anchor" href="#topological-sort">§</a>Topological Sort</h5>
<p>To create a topological sort from a DAG</p>
<ol>
<li>Remove vertex that has indegree of 0</li>
<li>Update other indegrees of other vertices who are neighbors of removed vertex</li>
<li>Go to 1</li>
</ol>
<p>cyclic graph -&gt; halt</p>
<p><a href="https://leetcode.com/problems/alien-dictionary/" target="_blank" rel="external">Alien Dictionary</a></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Solution &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">alienOrder</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;&amp; words)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (words.size()==<span class="number">0</span>)</span><br><span class="line">            return <span class="string">""</span>;</span><br><span class="line">        <span class="built_in">unordered_map</span>&lt;<span class="keyword">char</span>, <span class="built_in">unordered_set</span>&lt;<span class="keyword">char</span>&gt;&gt; <span class="built_in">map</span>;</span><br><span class="line">        <span class="built_in">unordered_map</span>&lt;<span class="keyword">char</span>, <span class="keyword">int</span>&gt; degree;</span><br><span class="line">        <span class="comment">//build graph</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> word:words)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> ch:word)</span><br><span class="line">                degree[ch] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; words.size()<span class="number">-1</span>; ++i)&#123;</span><br><span class="line">            <span class="built_in">string</span> cur = words[i];</span><br><span class="line">            <span class="built_in">string</span> next = words[i+<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">int</span> len = min(cur.length(),next.length());</span><br><span class="line">            <span class="keyword">if</span> (cur.length()&gt;next.length() &amp;&amp; cur.substr(<span class="number">0</span>,len).compare(next)==<span class="number">0</span>)</span><br><span class="line">                return <span class="string">""</span>;<span class="comment">//illegal</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; len; ++j)&#123;</span><br><span class="line">                <span class="keyword">char</span> c1 = cur[j], c2 = next[j];</span><br><span class="line">                <span class="keyword">if</span> (c1!=c2)&#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="built_in">map</span>.find(c1)==<span class="built_in">map</span>.end())</span><br><span class="line">                        <span class="built_in">map</span>[c1] = <span class="built_in">unordered_set</span>&lt;<span class="keyword">char</span>&gt;(<span class="number">0</span>);</span><br><span class="line">                    <span class="keyword">if</span> (<span class="built_in">map</span>[c1].count(c2)==<span class="number">0</span>)&#123;</span><br><span class="line">                        <span class="built_in">map</span>[c1].insert(c2);</span><br><span class="line">                        degree[c2] += <span class="number">1</span>;</span><br><span class="line">                    &#125; </span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//topological</span></span><br><span class="line">        <span class="built_in">string</span> res = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">char</span> ch;</span><br><span class="line">        <span class="built_in">queue</span>&lt;<span class="keyword">char</span>&gt; q;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> itr = degree.begin(); itr != degree.end(); ++itr)&#123;</span><br><span class="line">            <span class="keyword">if</span> ((*itr).second == <span class="number">0</span>)</span><br><span class="line">                q.push((*itr).first);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (!q.empty())&#123;</span><br><span class="line">            ch = q.front();</span><br><span class="line">            q.pop();</span><br><span class="line">            res += ch;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">map</span>.find(ch)!=<span class="built_in">map</span>.end())&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">auto</span> next:<span class="built_in">map</span>[ch])&#123;</span><br><span class="line">                    degree[next] -= <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">if</span> (degree[next] == <span class="number">0</span>)</span><br><span class="line">                        q.push(next);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (res.length()!=degree.size()) <span class="comment">// existcircle</span></span><br><span class="line">            return <span class="string">""</span>;</span><br><span class="line">        return res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><a href="https://leetcode.com/problems/course-schedule/" target="_blank" rel="external">https://leetcode.com/problems/course-schedule/</a></p>
<p><a href="https://leetcode.com/problems/course-schedule-ii/" target="_blank" rel="external">https://leetcode.com/problems/course-schedule-ii/</a></p>
<h5 id="union-find"><a class="header-anchor" href="#union-find">§</a>Union-Find</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UnionFind</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] id, size;</span><br><span class="line">        <span class="keyword">int</span> count;</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">UnionFind</span><span class="params">(<span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.id = <span class="keyword">new</span> <span class="keyword">int</span>[len];</span><br><span class="line">            <span class="keyword">this</span>.size = <span class="keyword">new</span> <span class="keyword">int</span>[len];</span><br><span class="line">            <span class="keyword">this</span>.count = len;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> root(p) == root(q);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">union</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> pi = root(p), qi = root(q);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.size[pi] &lt; <span class="keyword">this</span>.size[qi]) &#123;</span><br><span class="line">                <span class="keyword">this</span>.id[pi] = qi;</span><br><span class="line">                <span class="keyword">this</span>.size[qi] += <span class="keyword">this</span>.size[pi];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.id[qi] = pi;</span><br><span class="line">                <span class="keyword">this</span>.size[pi] += <span class="keyword">this</span>.size[qi];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">this</span>.count--;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">root</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">while</span> (i != id[i]) &#123;</span><br><span class="line">                id[i] = id[id[i]]; <span class="comment">// path compression</span></span><br><span class="line">                i = id[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://leetcode.com/problems/graph-valid-tree/" target="_blank" rel="external">Graph Valid Tree</a></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Solution &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; par, <span class="keyword">int</span> cur)</span></span>&#123;</span><br><span class="line">        return par[cur]==cur ? cur : par[cur] = find(par, par[cur]); <span class="comment">//compress path</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">validTree</span><span class="params">(<span class="keyword">int</span> n, <span class="built_in">vector</span>&lt;pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&gt;&amp; edges)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; par(n);</span><br><span class="line">        iota(begin(par), end(par), <span class="number">0</span>); <span class="comment">//0..n-1</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> edge:edges)&#123;</span><br><span class="line">            <span class="keyword">int</span> u = find(par, edge.first), v = find(par, edge.second);</span><br><span class="line">            par[u] = v;</span><br><span class="line">            <span class="keyword">if</span> (v==u)</span><br><span class="line">                return <span class="literal">false</span>; <span class="comment">//circle</span></span><br><span class="line">            n -= <span class="number">1</span>;</span><br><span class="line">        &#125; </span><br><span class="line">        return n==<span class="number">1</span>;<span class="comment">//connected</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><a href="https://leetcode.com/problems/redundant-connection/" target="_blank" rel="external">Redundant Connection</a>, <a href="https://leetcode.com/problems/redundant-connection-ii/" target="_blank" rel="external">Redundant Connection II</a></p>
<ol>
<li>
<p>If there is a node having two parents. Store them as candidates A and B, and set the second edge invalid.<br>
[5,1], 5 is parent of 1</p>
</li>
<li>
<p>Perform normal union find.</p>
</li>
<li>
<ol>
<li>
<p>It is now valid tree =&gt; return candidate B.</p>
</li>
<li>
<p>It is still not valid tree</p>
</li>
<li>
<ol>
<li>Candidates not existing =&gt; there is a loop, return current edge.<br>
[5,1],[1,2],[2,3],[3,4],[4,5], loop =&gt; current[4,5]</li>
<li>Candidates existing =&gt; return candidate A instead of B.<br>
[1,5],[4,5],[1,2],[2,3],[3,4], 5 has 2 parents =&gt; remove[4,5]<br>
=&gt; union find, f(1)=5, f(2)=5, f(3)=5, f(4)=5, f(5)=5 =&gt; remove[1,5] instead</li>
</ol>
</li>
</ol>
</li>
</ol>
<p><strong>【Amazon-OA2面经】城市连接问题，即MST</strong><br>
给十几个城市供电，连接不同城市的花费不同，让花费最小同时连到所有的边。给出一系列connection类，里面是edge两端的城市名和它们之间的一个cost，找出要你挑一些边，把所有城市连接起来并且总花费最小。不能有环，最后所以城市要连成一个连通块。</p>
<p>Algorithm Steps: (Kruskal’s Algorithm)</p>
<ul>
<li>Sort the graph edges with respect to their weights</li>
<li>Start adding edges to the MST from the edge with the smallest weight until the edge of the largest weight</li>
<li>Only add edges which doesn’t form a cycle , edges which connect only disconnected components</li>
</ul>
<h5 id="optimal-account-balancing-social-network-graph-database"><a class="header-anchor" href="#optimal-account-balancing-social-network-graph-database">§</a><a href="https://leetcode.com/problems/optimal-account-balancing/" target="_blank" rel="external">Optimal Account Balancing</a>, Social Network Graph Database</h5>
<p>pre-process; non-zero debt -&gt; DFS</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Solution &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; debt;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">helper</span><span class="params">(<span class="keyword">int</span> cur)</span></span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (cur &lt; debt.size() &amp;&amp; debt[cur]==<span class="number">0</span>) </span><br><span class="line">            ++cur;</span><br><span class="line">    	<span class="keyword">int</span> res = INT_MAX;</span><br><span class="line">    	<span class="keyword">for</span> (<span class="keyword">int</span> i = cur+<span class="number">1</span>, prev = <span class="number">0</span>; i &lt; debt.size(); ++i)</span><br><span class="line">    	  <span class="keyword">if</span> (debt[i] != prev &amp;&amp; debt[i]*debt[cur] &lt; <span class="number">0</span>)&#123; <span class="comment">// skip already tested or same sign debt</span></span><br><span class="line">              debt[i] += debt[cur];</span><br><span class="line">              res = min(res, helper(cur+<span class="number">1</span>)+<span class="number">1</span>);</span><br><span class="line">              debt[i] -= debt[cur];</span><br><span class="line">              prev = debt[i];</span><br><span class="line">          &#125;</span><br><span class="line">    	return res &lt; INT_MAX? res : <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">minTransfers</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt;&amp; transactions)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, <span class="keyword">long</span>&gt; balance; </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> t: transactions)</span><br><span class="line">            balance[t[<span class="number">0</span>]] -= t[<span class="number">2</span>], balance[t[<span class="number">1</span>]] += t[<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; b: balance) </span><br><span class="line">            <span class="keyword">if</span>(b.second != <span class="number">0</span>)</span><br><span class="line">                debt.push_back(b.second);</span><br><span class="line">        return helper(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h5 id="minimum-height-tree"><a class="header-anchor" href="#minimum-height-tree">§</a><a href="https://leetcode.com/problems/minimum-height-trees/" target="_blank" rel="external">Minimum Height Tree</a></h5>
<p>keep deleting leaves layer-by-layer, until reach the root.</p>
<p>Specifically, first find all the leaves, then remove them. After removing, some nodes will become new leaves. So we can continue remove them. Eventually, there is only 1 or 2 nodes left. If there is only one node left, it is the root. If there are 2 nodes, either of them could be a possible root.</p>
<p>Time Complexity: Since each node will be removed at most once, the complexity is O(n).</p>
<h5 id="implement-hashmap"><a class="header-anchor" href="#implement-hashmap">§</a><strong>Implement HashMap</strong></h5>
<p><a href="https://www.geeksforgeeks.org/implementing-our-own-hash-table-with-separate-chaining-in-java/" target="_blank" rel="external">https://www.geeksforgeeks.org/implementing-our-own-hash-table-with-separate-chaining-in-java/</a></p>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/04/07/X7-OOD/" itemprop="url">
                  X7_OOD
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2018-04-07T10:30:37-07:00" content="2018-04-07">
              2018-04-07
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/System-Design/" itemprop="url" rel="index">
                    <span itemprop="name">System Design</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/System-Design/Program/" itemprop="url" rel="index">
                    <span itemprop="name">Program</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/System-Design/Program/Leetcode/" itemprop="url" rel="index">
                    <span itemprop="name">Leetcode</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2018/04/07/X7-OOD/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/04/07/X7-OOD/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2018/04/07/X7-OOD/" class="leancloud_visitors" data-flag-title="X7_OOD">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="design-food-delivery-app"><a class="header-anchor" href="#design-food-delivery-app">§</a>Design Food Delivery App</h4>
<ul>
<li>
<p>OOD fundamental concepts: Inheritance, encapsulation, abstrction and polymorphism<br>
First POJO(Plain Old Java Object), Then methods</p>
</li>
<li>
<p>Scenario, Use Cases</p>
<blockquote>
<ol>
<li>User can search different restaurant</li>
<li>User can select a restaurant</li>
<li>User sees a menu</li>
<li>Restaurant can change the menu any time</li>
<li>User adds an item from menu</li>
<li>User orders the food</li>
<li>User can track the order in real time</li>
<li>User can cancel the order</li>
<li>User pays for the order</li>
</ol>
</blockquote>
</li>
<li>
<p>Solution</p>
<blockquote>
<p>Design Patterns involved in the design of this app:</p>
<ol>
<li>Builder Design Pattern (For adding food item and ordering)</li>
<li>Iterator Pattern (User Sees Menu)</li>
<li>Observer Pattern (Track an order in Real Time)</li>
<li>(Command Design Pattern) Order and cancellation of Food</li>
</ol>
</blockquote>
</li>
<li>
<p>Major Classes</p>
<blockquote>
<p>User</p>
<p>Restaurant</p>
<p>Menu</p>
<p>Item</p>
<p>Order</p>
</blockquote>
</li>
<li>
<p>Patterns</p>
<ul>
<li>
<p>Builder Pattern</p>
<blockquote>
<p>reference: <a href="https://dzone.com/articles/design-patterns-the-builder-pattern" target="_blank" rel="external">I</a>, <a href="https://www.tutorialspoint.com/design_pattern/builder_pattern.htm" target="_blank" rel="external">II</a></p>
</blockquote>
</li>
<li>
<p>Iterator Pattern</p>
</li>
<li>
<p><strong>Observer Pattern</strong><br>
Subject       —— notify() ——&gt;     Observers<br>
​    &lt;— subscribe(), unsubscribe() —<br>
eg. When DeliveryStatus changes, we can use observery pattern to notify users</p>
<blockquote>
<p>kafka:queue, pub/sub</p>
</blockquote>
</li>
<li>
<p><strong>Command Pattern</strong><br>
eg. In order to  <code>pulic class CancelFood: IFoodOrderCommands</code> and  <code>public class OrderFood: IFoodOrderCommands</code>, so we can use command pattern: <code>public interface IFoodOrderCommands</code></p>
<blockquote>
<p>java: runnable, callable</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>Summary</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class&#123; /*write class signature first,*/</span><br><span class="line">//implement</span><br><span class="line">//call servers</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="reading-materials"><a class="header-anchor" href="#reading-materials">§</a>Reading Materials</h4>
<ol>
<li><a href="http://mp.weixin.qq.com/s?__biz=MzUzODEyMzIyOA==&amp;mid=2247484245&amp;idx=1&amp;sn=b3e8dfcc9fb07a9385f59ba26d0e13b2&amp;chksm=faddcde6cdaa44f0d96fc21204e2842ca9803b299a8bc971c1688e12ef037b4df1a7ea0b6ba4&amp;scene=21#wechat_redirect" target="_blank" rel="external">OODmock interview: Design a Vending Machine</a></li>
<li><a href="http://mp.weixin.qq.com/s?__biz=MzUzODEyMzIyOA==&amp;mid=2247483985&amp;idx=1&amp;sn=4a339762ffd5882f46e0e3089df09749&amp;chksm=faddcce2cdaa45f44ec278c17d9990ccf8dd611f9bb195606bc7dec2f10a7b2f93939468ffd9&amp;scene=21#wechat_redirect" target="_blank" rel="external">OODmock interview：How to design meeting room schedulingsystem</a></li>
<li><a href="https://www.careercup.com/question?id=5638730112040960" target="_blank" rel="external">Amazon Interview Question for SDE-2s | Design OO food delivery app catering to use cases</a></li>
<li><a href="https://github.com/gmershad/FoodDeliveryApp" target="_blank" rel="external">Design OO food delivery app with C# &amp; Design Patterns</a></li>
</ol>
<h4 id="problem"><a class="header-anchor" href="#problem">§</a>Problem</h4>
<h5 id="760-find-anagram-mappings-unordered-map"><a class="header-anchor" href="#760-find-anagram-mappings-unordered-map">§</a><a href="https://leetcode.com/problems/find-anagram-mappings" target="_blank" rel="external">760. Find Anagram Mappings</a> | unordered_map</h5>
<h5 id="longest-common-substring-dp"><a class="header-anchor" href="#longest-common-substring-dp">§</a><a href="https://www.geeksforgeeks.org/longest-common-substring" target="_blank" rel="external">Longest Common Substring</a> | DP</h5>
<h5 id="718-maximum-length-of-repeated-subarray-dp"><a class="header-anchor" href="#718-maximum-length-of-repeated-subarray-dp">§</a><a href="https://leetcode.com/problems/maximum-length-of-repeated-subarray" target="_blank" rel="external">718. Maximum Length of Repeated Subarray</a> | DP</h5>
<p>double for loop</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (A[i<span class="number">-1</span>] == B[j<span class="number">-1</span>])&#123;</span><br><span class="line">    dp[i][j] = <span class="number">1</span> + dp[i<span class="number">-1</span>][j<span class="number">-1</span>];</span><br><span class="line">    update max;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Space improvement</span></span><br><span class="line"><span class="comment">// Since we need f[i-1][j-1], we have to update from right</span></span><br><span class="line">    	<span class="keyword">if</span> (n &gt; m)</span><br><span class="line">    		return findLength(B,A);</span><br><span class="line">    	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; dp(n+<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i)</span><br><span class="line">    		<span class="keyword">for</span> (<span class="keyword">int</span> j = n; j &gt;= <span class="number">1</span>; --j)</span><br><span class="line">    			<span class="keyword">if</span> (A[i<span class="number">-1</span>] == B[j<span class="number">-1</span>])&#123;</span><br><span class="line">    				dp[j] = <span class="number">1</span>+dp[j<span class="number">-1</span>];</span><br><span class="line">    				res = max(res, dp[j]);</span><br><span class="line">    			&#125;</span><br><span class="line">    			<span class="keyword">else</span></span><br><span class="line">    				dp[j] = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>
<h5 id="bloomberg-高频题-航班规划-greedy"><a class="header-anchor" href="#bloomberg-高频题-航班规划-greedy">§</a><a href="http://algorithms.tutorialhorizon.com/dynamic-programming-longest-common-substring" target="_blank" rel="external"> Bloomberg 高频题 | 航班规划</a> | Greedy</h5>
<blockquote>
<p>给你一堆人从纽约飞各个地方开会的 cost。比如<br>
A 去 城市SF, LA的 cost 分别是 200, 300<br>
B 去城市SF, LA的 cost 分别是 200, 400<br>
C 去城市SF, LA的 cost 分别是 100, 400<br>
D 去城市SF, LA的 cost 分别是 320, 210<br>
然后保证一半的人去 SF，一半的人去 LA，使得总的 cost 最小</p>
</blockquote>
<ol>
<li>
<p>Represent the Input: Two Dimensional Array / Matrix</p>
</li>
<li>
<p>Greedy =&gt; number not equal<br>
if constSF&gt;constLA, numLA++<br>
else if constLA&gt;constSF, numSF++<br>
else numSame++ // Equal cost</p>
</li>
<li>
<p>Switch smallest difference</p>
</li>
<li>
<p>Check Legal</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (arr = <span class="keyword">null</span> || arr.length == <span class="number">0</span>)</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line"><span class="keyword">if</span> (m%<span class="number">2</span> != <span class="number">0</span>)</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br></pre></td></tr></table></figure>
<p>Or use <code>Guava: Preconditions.checkArgument</code></p>
</li>
</ol>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/03/26/X6-DP-Knapsack/" itemprop="url">
                  X6_DP & Knapsack
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2018-03-26T16:49:03-07:00" content="2018-03-26">
              2018-03-26
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Program/" itemprop="url" rel="index">
                    <span itemprop="name">Program</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Program/Leetcode/" itemprop="url" rel="index">
                    <span itemprop="name">Leetcode</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2018/03/26/X6-DP-Knapsack/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/03/26/X6-DP-Knapsack/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2018/03/26/X6-DP-Knapsack/" class="leancloud_visitors" data-flag-title="X6_DP & Knapsack">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h5 id="problem"><a class="header-anchor" href="#problem">§</a>Problem</h5>
<ul>
<li>
<p><a href="https://leetcode.com/problems/coin-change/description/" target="_blank" rel="external">322. Coin Change</a></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Solution &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">coinChange</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; coins, <span class="keyword">int</span> amount)</span> </span>&#123;</span><br><span class="line">    	<span class="keyword">int</span> n = coins.size();</span><br><span class="line">    	<span class="keyword">if</span> (n == <span class="number">0</span>)</span><br><span class="line">    		return <span class="number">-1</span>;</span><br><span class="line">    	sort(coins.rbegin(),coins.rend());</span><br><span class="line">    	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; dp(amount+<span class="number">1</span>, amount+<span class="number">1</span>);</span><br><span class="line">    	dp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    	<span class="keyword">for</span> (<span class="keyword">auto</span> coin : coins)</span><br><span class="line">    		<span class="keyword">for</span> (<span class="keyword">int</span> w = coin; w &lt;= amount; ++w)</span><br><span class="line">    			dp[w] = min(dp[w], dp[w-coin]+<span class="number">1</span>);</span><br><span class="line">    	return dp[amount] &gt; amount ? <span class="number">-1</span> : dp[amount];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Others:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// if coin[1000, 2000], there is no need for i starting at 0</span></span><br><span class="line"><span class="comment">// coins[0] + 1 may overflow if coins[0] == Integer.MAX_VALUE</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = coins[<span class="number">0</span>]; i &lt;= amount; i++) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> coin : coins) &#123;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><a href="https://leetcode.com/problems/combination-sum-iv/description/" target="_blank" rel="external">377. Combination Sum IV</a>, similar</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Solution &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">   <span class="function"><span class="keyword">int</span> <span class="title">combinationSum4</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">    	<span class="keyword">int</span> n = nums.size();</span><br><span class="line">    	<span class="keyword">if</span> (n == <span class="number">0</span>)</span><br><span class="line">    		return <span class="number">0</span>;</span><br><span class="line">    	sort(nums.begin(),nums.end());</span><br><span class="line">    	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; dp(target+<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    	dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">/* remove duplicate.</span><br><span class="line">        eg. 1 1 2 = 1 2 1, since 1 will not consider again</span><br><span class="line">    	for (auto num : nums)</span><br><span class="line">    		for (int w = num; w &lt;= target; ++w)</span><br><span class="line">        */</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> w = nums[<span class="number">0</span>]; w &lt;= target; ++w)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> num : nums)&#123;</span><br><span class="line">                <span class="keyword">if</span> (w &lt; num)</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                dp[w] += dp[w-num];</span><br><span class="line">            &#125;</span><br><span class="line">    	return dp[target];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>DP</p>
<ol>
<li>Deduction Formula</li>
<li>Initialization</li>
<li>Space Improvement (Bonus)</li>
</ol>
<ul>
<li>Audible 题：BugdetShopping</li>
</ul>
<blockquote>
<p>n dollars, bundleQuantities array, bundleCosts array</p>
<p>eg. Helen has n = 50 dollars to purchase notebooks from 2 stores described by bundleQunantities = [20, 19] and bundleCost = [24, 20]. She makes the following purchases:<br>
​	One bundle of 20 notebooks from shop 0 at a cost 24 dollars and has 50 – 24 = 26 dollars left.<br>
​	Another bundle of 20 notebooks from shop 0 at a cost 24 dollars and has 26 – 24 = 2 dollars left.<br>
Helen can’t afford any more notebooks, so we return the total number of notebooks she was able to purchase: 20 + 20 = 40.</p>
</blockquote>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// f(i) is the maximum number of notebook given i dollar</span></span><br><span class="line">f[i] = max(f[i – b.cost] + b.quantity) given different b</span><br><span class="line">maxf = <span class="number">0</span>, maxf = max(maxf, f[i])</span><br></pre></td></tr></table></figure>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> max = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span>[] f = <span class="keyword">new</span> <span class="keyword">int</span>[n + <span class="number">1</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = bundles[<span class="number">0</span>].cost; i &lt; f.length; i++) &#123;</span><br><span class="line">	<span class="keyword">for</span> (Bundle b : bundles) &#123;</span><br><span class="line">		<span class="keyword">if</span> (b.cost &gt; i) &#123;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (i == b.cost) &#123;</span><br><span class="line">			f[i] = Math.max(f[i], b.quantity);</span><br><span class="line">			max = Math.max(max, f[i]);</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">      	<span class="keyword">int</span> c = f[i - b.cost];</span><br><span class="line">		<span class="keyword">if</span> (c == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		f[i] = Math.max(f[i], c + b.quantity);</span><br><span class="line">		System.out.println(i + <span class="string">"="</span> + f[i]);</span><br><span class="line">		max = Math.max(max, f[i]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>Coin Change is unlimited, while Knapsack is limited</strong></p>
<ul>
<li>
<p>背包问题</p>
<ol>
<li>Backpack<br>
Given n items with size Ai, an integer m denotes the size of a backpack. How full you can fill this backpack?</li>
</ol>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i = [0, A.length)</span><br><span class="line">	j = [m, A[i]]</span><br><span class="line">		result[j] = max(result[j-A[i]]+A[i], result[j])</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>
<p>Backpack II<br>
Given n items with size Ai and value Vi, and a backpack with size m. What’s the maximum value can you put into the backpack?<br>
Example<br>
Given 4 items with size [2, 3, 5, 7] and value [1, 5, 2, 4], and a backpack with size 10. The maximum value is 9.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i = [0, A.length)</span><br><span class="line">	j = [m, A[i]]</span><br><span class="line">		result[j] = max(result[j-A[i]]+v[i], result[j])</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Knapsack_problem" target="_blank" rel="external">https://en.wikipedia.org/wiki/Knapsack_problem</a><br>
<a href="https://www.geeksforgeeks.org/knapsack-problem" target="_blank" rel="external">https://www.geeksforgeeks.org/knapsack-problem</a><br>
<a href="https://brilliant.org/wiki/backpack-problem" target="_blank" rel="external">https://brilliant.org/wiki/backpack-problem</a></p>
</li>
</ol>
</li>
<li>
<p>背包问题变种</p>
<ul>
<li>
<p><a href="">474. Ones and Zeroes</a></p>
<blockquote>
<p>maximize chossedn string -&gt; m’s 1, n’s 0</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for k=1..l</span><br><span class="line">	i=m..s0, j=n..s1</span><br><span class="line">		dp[i][j] = max(dp[i][j],dp[i-s0][j-s1]+1)// wo/w s</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><a href="">494. Target Sum</a></p>
<blockquote>
<p>+/- ai = s</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sum(P) - sum(N) = target           </span><br><span class="line">sum(P) + sum(N) + sum(P) - sum(N) = target + sum(P) + sum(N)</span><br><span class="line">2 * sum(P) = target + sum(nums)</span><br><span class="line"></span><br><span class="line">for num:nums</span><br><span class="line">	for w = (t+s)/2 ... num</span><br><span class="line">		dp[w] += dp[w-num]</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><a href="https://leetcode.com/problems/partition-equal-subset-sum/description/" target="_blank" rel="external">416. Partition Equal Subset Sum</a></p>
<blockquote>
<p>find if the array can be partitioned into two subsets, that sum is equal</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sum(subset1) = sum/2</span><br><span class="line"></span><br><span class="line">for num:nums</span><br><span class="line">	for w = sum/2 ... num</span><br><span class="line">		dp[w] = dp[w]|dp[w-num]</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h5 id="thinking"><a class="header-anchor" href="#thinking">§</a>Thinking</h5>
<ul>
<li>
<p>DP</p>
<ol>
<li>
<p>先枚举物品，再枚举容量。<br>
eg. [1, 2, 3] 组合4时，(1, 1, 2) == (1, 2, 1)。因为同一个物体不会再次考虑</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* remove duplicate.</span><br><span class="line">        eg. 1 1 2 = 1 2 1, since 1 will not consider again</span><br><span class="line">    	for (auto num : nums)</span><br><span class="line">    		for (int w = num; w &lt;= target; ++w)</span><br><span class="line">        */</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>先枚举容量，再枚举物品。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> w = nums[<span class="number">0</span>]; w &lt;= target; ++w)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> num : nums)</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li>
<p>背包问题：</p>
<ol>
<li>枚举物品</li>
<li>枚举容量<br>
增序枚举，重复装入某个物品，而且尽可能多的，使价值最大<br>
逆序枚举：物品至多装一次</li>
</ol>
</li>
<li>
<p><a href="https://github.com/tianyicui/pack" target="_blank" rel="external">背包九讲</a></p>
</li>
</ul>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/03/24/Responsive-Design/" itemprop="url">
                  Responsive Design
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2018-03-24T14:55:11-07:00" content="2018-03-24">
              2018-03-24
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Web/" itemprop="url" rel="index">
                    <span itemprop="name">Web</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2018/03/24/Responsive-Design/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/03/24/Responsive-Design/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2018/03/24/Responsive-Design/" class="leancloud_visitors" data-flag-title="Responsive Design">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>Lydna | <a href="https://www.lynda.com/Web-Responsive-Design-tutorials/Welcome/104969/115611-4.html" target="_blank" rel="external">Lerning Responsive Design</a></p>
</blockquote>
<h5 id="responsive-web-design-ethan-marcotte"><a class="header-anchor" href="#responsive-web-design-ethan-marcotte">§</a>Responsive Web Design -  Ethan Marcotte</h5>
<ol>
<li>Fluid Grid for flexible layouts</li>
<li>Media Queries to help you adapt content to specific screen sizes</li>
<li>Flexible Images and media that respond to changes in screen sizes as well.</li>
</ol>
<ul>
<li>
<p>HTML: clean code, proper semantics HTMLs</p>
<p>CSS: media queries, fluid layout, transitions css graphics</p>
<p>JavaScript: resourse loading, adaptive media, device functionality</p>
</li>
</ul>
<h5 id="concepts"><a class="header-anchor" href="#concepts">§</a>Concepts</h5>
<ul>
<li>
<p>viewport(have a minimum scaling factor) &gt; the screen’s resolution</p>
<p>Mobile browsers will display a web page within the viewport ans the shrink that viewport down until the content fits within the width of the screen itself.  While this usually results in tiny pages, it does allow the user to see the page in its entirety and decide which areas of the page they’d like to zoom up to, and read.</p>
<p>=&gt; how to control both the viewport size and its initial scale factor.</p>
</li>
<li>
<p>Controlling Viewports</p>
<ol>
<li>
<p>viewport meta tag <code>met name=&quot;viewport&quot; content=&quot;width=480, initial-scale=1&quot;&gt;</code></p>
</li>
<li>
<p>@viewport CSS rule <code>@viewport{width: 480px; zoom: 1;}</code></p>
<p>should be placed before media queries</p>
</li>
</ol>
<ul>
<li>
<p><strong>device width</strong>: instructs the browser to set the viewport to the exact size as the available screen pixels.</p>
<p>And the browser automatically sets initial scale to 100%.</p>
<p>In fact, on iOS devices, there’s a bug with initial scale that affects pages when the orientation changes, so many people advise leaving initial scale off entirely unless you need to set the value to something other than 100%.</p>
</li>
<li>
<p>zoom: 2, -&gt; 200%</p>
</li>
<li>
<p>control how much zoom</p>
<p>eg. <code>minimum-scale=1 maximum-scale=2</code> in tag, <code>min-zoom:1; max-zoom:2</code>in CSS. The user can scale up to 200% but can’t scale down pass 100%.</p>
<p>eg. <code>user-scalable=no</code> or <code>user-zoom:fixed;</code></p>
</li>
</ul>
</li>
<li>
<p>Screen density is the number of pixels within a physical area of a screen, and newer screens are featuring higher and higher screen densities every year</p>
<ol>
<li>
<p>hardware pixels</p>
<p>eg. Let’s say you had a line of text that was 30 pixels high on a lower-density screen. The same text mapped to the higher- density screen would now appear twice as <u>small</u>.</p>
</li>
<li>
<p>reference pixels - “CSS pixel”</p>
<p>eg. If you’ve specified that an element be 50 pixels wide, it might map to the first screen at exactly 50 pixels if the hardware and reference pixels were the same.<br>
On a higher-density screen, however, the device would actually display the same element over 100 hardware pixels to ensure that it remains the same visual size.</p>
<ul>
<li>scaling factor - device-pixel-ratio, the ratio between reference pixels and hardware pixels</li>
</ul>
</li>
</ol>
</li>
<li>
<p>Designing for multiple screen densities</p>
<ul>
<li>
<p>Optimize graphics for higher-density displays - Reduce bitmap graphics</p>
<ol>
<li>
<p>SVG</p>
<p>Often larger than bitmaps</p>
<p>Graphics are redrawn with each screen change</p>
</li>
<li>
<p>CSS</p>
<p>Complex artwork is difficult</p>
<p>Often require non-semantic markup</p>
<p>Property support isn’t universal</p>
</li>
<li>
<p>use icon fonts</p>
</li>
</ol>
</li>
<li>
<p>Screen-density targeting option</p>
<ol>
<li>
<p>Don’t target screen, but use high-res graphocs where needed<br>
issue1: Higher-resolution graphics are larger in size -&gt; some of your users to download larger images than they really need.<br>
issue2: Not all screens use the same scaling factors -&gt; you’d have to account for the largest size needed, which again leads to unnecessary file sizes in most instances.</p>
</li>
<li>
<p>target</p>
<p>if you are targeting CSS background images, you can use media queries to target specific device-pixel-ratios. -&gt; JavaScript</p>
</li>
</ol>
</li>
</ul>
</li>
<li>
<p>Media Queries</p>
<p><code>@media [not | only] screen [and] (expression){}</code> in CSS</p>
<p><code>media=&quot;screen and (min-width: 480px), screen and (orientation: landscape)&quot;</code> in tag</p>
<p>modified: <code>@import url(example.css) screen and (max-width: 480px);</code></p>
</li>
<li>
<p>breakpoint: A breakpoint indicates the moment your layout switches from one layout to another, and is usually triggered by the width of a screen.</p>
<ol>
<li><code>@media only screen and (max-width: 480px){}</code> // mobile, eg. 480/16 = 30em</li>
<li><code>@media only screen and (min-width:481px) and (max-width: 768px){}</code> //tablet, 30em 48em</li>
<li><code>@media only screen and (min-width: 769px)</code> //desktop, 48em</li>
</ol>
<p>if use <code>em</code>, the width of the screen is set relative to the device’s font size.</p>
</li>
<li>
<p>Fluid grid</p>
<p>eg. Grid systems</p>
<p>downsides of frameworks: class-based, non-semantic, container/clearing elements, large in size/extra code</p>
</li>
<li>
<p>Making images responsive</p>
<ol>
<li>
<p>define with different @media</p>
<p>but, in <u>earlier versions of Android</u>, all of the CSS background images would be downloaded, not just the ones needed for the appropriate media query.</p>
</li>
<li>
<p>modify your .htaccess file, link to their responsive images JavaScript file, and add a query string on any image that requires a larger desktop version of that image.</p>
<p>but, more complex solution, JS parse slower load time(and often replacement images are requested after the original image is already downloaded.)</p>
<p>And that’s the evolution of browser prefetching: speed up load time, but may download elements that will be replaced.</p>
</li>
</ol>
<p>-&gt;</p>
<ol>
<li>WHTWQ: add a new attribute called <code>srcset</code>, eg. <code>&lt;img … src=&quot;&quot; srcset=&quot;1.png 800w, 2.png 600w&quot;&gt;</code><br>
benefits: straight forward, uncluttered, no new html elements, backwards compatible</li>
<li>w3c: <code>&lt;picture&gt;&lt;source..&gt;&lt;source..&gt;&lt;img&gt;&lt;/picture&gt;</code><br>
benefits: acts as parent for range of <img> elements. multiple source options with alternate images, image properties, and media queries. user agent selects matching images</li>
</ol>
</li>
<li>
<p>Responsive forms<br>
start by considering the mobile context first<br>
eg. use <code>&lt;label&gt;&lt;input.. placehold=&quot;balabala&quot; required=&quot;required&quot;&gt;&lt;/label&gt;</code><br>
Makes submitting data easier, automates input when possible, and even combines form elements to require less input from the user.</p>
<ol>
<li>combile address into a single input ans use placeholder text to show format.</li>
<li>single dropdown menu instead of using a radio button grouping of multiple choices</li>
</ol>
</li>
<li>
<p>Performance</p>
<ul>
<li>Network connections, bandwidth speed, network latency</li>
<li>keep code lean
<ol>
<li>use standards compliant code</li>
<li>elimicate extraneous markup</li>
<li>keep external scripts and styles lean and efficient</li>
</ol>
</li>
<li>limit requests
<ol>
<li>eg. If you’re linking to multiple external scripts, try combining them into a single file.<br>
Or tools: Filament Group’s QuickConcat, Enhance.js, which can combine files at runtime into single request.</li>
<li>Combine images and icons into sprites -&gt; use same images for multiple</li>
<li>Use data URI: allows you to embed images directly into your CSS without having to request the image from the server</li>
<li>Evaluate any external resource to make sure that you’re actually using them.</li>
<li>use a JavaScript library in one context but not the other.</li>
</ol>
</li>
</ul>
</li>
</ul>
<h5 id="responsice-design-strategies"><a class="header-anchor" href="#responsice-design-strategies">§</a>Responsice Design Strategies</h5>
<ul>
<li>Designing for the appropriate:  targeting the appropriate context in which the site will be used.</li>
<li>Planning a responsie design<br>
develop a content strategy, think about breakpoints<br>
tweak point -&gt; allow you to refine your designs throughout the scaling proces<br>
device-specific functionality: geo location, instant messaging, touch sensitivity<br>
layout considerations: plan out your navigation, creat consistent coding standards</li>
<li>Building responsive mockups</li>
<li>Developing a context strategy for responsive sites<br>
goas: emphasize important content, make relationship clear, make it accessible on small screens<br>
start with content -&gt; think about prioritize/purpose -&gt; generate a set of rules that govern how content should be displayed and shifted as screen sizes change</li>
<li>Understanding the mobile context</li>
<li>Designing for mobile capabilities<br>
location, motion/accelerometer, built in compass, media, touch screen, phone</li>
<li>Creating flexible HTML
<ol>
<li>write clean code</li>
<li>use html5 if possible</li>
<li>explore microformats</li>
<li>standards for each content area</li>
<li>creat smaller sections of content, reassess layout goals/scripting</li>
</ol>
</li>
<li>Testing responsive designs</li>
</ul>
<h5 id="conclution"><a class="header-anchor" href="#conclution">§</a>Conclution</h5>
<ul>
<li>
<p>Fluid grid framework</p>
<ul>
<li>benefits:<br>
speed up development<br>
help keep code consistent<br>
solid starting code base<br>
can add unnecessary code<br>
some require non-semantic code</li>
</ul>
</li>
</ul>
<ul>
<li>
<p>eg. Twitter’s Bootstrap: it’s a collection of HTML, CSS, and JavaScript that includes a fluid grid, starter layouts, UI components, and much, much more.</p>
</li>
<li>
<p>eg. Skeleton:  lightweight, includes a fluid grid, basic typography controls, and default styling for forms and buttons.</p>
</li>
<li>
<p>Responsice design tools</p>
</li>
</ul>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/03/22/X5-Interval-Sliding-Window/" itemprop="url">
                  X5_Interval & Sliding Window
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2018-03-22T15:39:57-07:00" content="2018-03-22">
              2018-03-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Program/" itemprop="url" rel="index">
                    <span itemprop="name">Program</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Program/Leetcode/" itemprop="url" rel="index">
                    <span itemprop="name">Leetcode</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2018/03/22/X5-Interval-Sliding-Window/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/03/22/X5-Interval-Sliding-Window/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2018/03/22/X5-Interval-Sliding-Window/" class="leancloud_visitors" data-flag-title="X5_Interval & Sliding Window">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h5 id="problem"><a class="header-anchor" href="#problem">§</a>Problem</h5>
<ul>
<li>
<p>Merge Intervals</p>
<ul>
<li>
<p>follow up</p>
<p>list in java is not thread safe: synchronized</p>
<p>concurrent list java</p>
</li>
<li>
<p>note</p>
<ol>
<li>先确认signature，再确认requirement<br>
work through test，画图说明</li>
<li>compare的时候要用Integer.compare，而不是相减，会溢出</li>
<li>collection.sort是modified merge sort（因为stable，保持相对顺序，eg. 1 2 2’ 3不会出现1 2’ 2 3）<br>
object use merge sort，primitive type use quick sort</li>
<li>用collections.emptyList()，是系统初始化好的，不用开辟额外的空间。如果用new Arraylist&lt;&gt;()会占新的空间</li>
<li>Runtime, 要根据代码nlogn</li>
<li>test case copy到代码附近</li>
<li>定义res时候直接最下面写return res。显得有条理</li>
<li>先定义cur，而不是每次a.get(i )，更清晰</li>
</ol>
</li>
<li>
<p>FB变种，raindrop</p>
<p>rope 0-1, [0.2,0.5], [0.75,1.0], [0.3,0.75]</p>
<ol>
<li>
<p>deal with float<br>
private static final float EPSILON = 1e-10<br>
Math.abs(a-b) &lt; EPSILON</p>
</li>
<li>
<p>If drops are given on by one. Not all in the begining. -&gt; 57. insert Interval</p>
<p>boolean isWet, 0-1 all is wet</p>
<p>注意处理边界，如果drop&gt;1</p>
</li>
</ol>
</li>
</ul>
</li>
<li>
<p><strong>Comparable vs Comparator in Java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义在class内部</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Movie</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">Movie</span>&gt;</span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Movie m)</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">Collection.sort(list);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义专门的compare函数</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RatingCompare</span> <span class="keyword">implements</span> <span class="title">Comparator</span>&lt;<span class="title">Movie</span>&gt;</span>&#123;</span><br><span class="line">  <span class="function">pulic <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Movie m1, Movie m2)</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">RatingCompare ratingCompare = <span class="keyword">new</span> <span class="function">Rating <span class="title">Compare</span><span class="params">()</span></span>;</span><br><span class="line">Collection.sort(list, ratingCompare);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Amazon OA Window Sum</p>
<blockquote>
<p>给定数组，给定长度，算出数组里面，在这个长度下，分别的连续和</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; Given array: [1,2,3,4,5,6,7]</span><br><span class="line">&gt; Given window: 3</span><br><span class="line">&gt; Output: [6,9,12,15,18]</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>Sliding Window</strong></p>
</li>
<li>
<p>Hard: <a href="https://leetcode.com/problems/maximum-sum-of-3-non-overlapping-subarrays" target="_blank" rel="external">689. Maximum Sum of 3 Non-Overlapping Subarrays</a></p>
<p>find 3, fixed subarray size = k =&gt; linear time</p>
<p>else , not linear time, different sol, is similar to the buy and sell stock problem.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1, 2, 1, 2, 6, 7, 5, 1</span><br><span class="line">...........[s1  ].....</span><br><span class="line">maxFromLeft      maxFromRight</span><br><span class="line">       1, 2, 1, 2, 6, 7, 5, 1</span><br><span class="line">presum:3, 3, 3, 8,13,12, 6 </span><br><span class="line">maxFL: 0, 0, 0, 3, 4       &lt;-index</span><br><span class="line">       3, 3, 3, 8, 13      &lt;-value</span><br><span class="line">maxFR: 0, 0, 0, 0, 4, 5, 6 &lt;-index</span><br><span class="line">       ., ., ., .,13,12, 6 &lt;-value</span><br><span class="line">     </span><br><span class="line">s1: [k, n-2k]; s0:[0,i-k]; s2:[i+k,n-1]</span><br><span class="line">sum = presum[maxFromLeft[i - k]] + presum[i] + presum[maxFromRight[i + k]]</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Solution &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; maxSumOfThreeSubarrays(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> k) &#123;</span><br><span class="line">    	<span class="keyword">int</span> n = nums.size();</span><br><span class="line">    	<span class="built_in">vector</span>&lt;<span class="keyword">long</span>&gt; presum(n,<span class="number">0</span>);</span><br><span class="line">    	<span class="keyword">long</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)&#123;</span><br><span class="line">        	<span class="keyword">if</span> (i&gt;=k)&#123;</span><br><span class="line">        		presum[i-k] = sum;</span><br><span class="line">        		sum -= nums[i-k];</span><br><span class="line">        	&#125;</span><br><span class="line">        	sum += nums[i];</span><br><span class="line">        &#125;</span><br><span class="line">        presum[n-k] = sum;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; maxFL(n,<span class="number">0</span>), maxFR(n,<span class="number">0</span>);</span><br><span class="line">        sum = <span class="number">0</span>; <span class="keyword">int</span> idx = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n<span class="number">-3</span>*k; ++i)&#123;</span><br><span class="line">        	<span class="keyword">if</span> (presum[i] &gt; sum)&#123;</span><br><span class="line">        		sum = presum[i];</span><br><span class="line">        		idx = i;</span><br><span class="line">        	&#125;</span><br><span class="line">        	maxFL[i] = idx;</span><br><span class="line">        &#125;</span><br><span class="line">        sum = <span class="number">0</span>; idx = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n-k; i &gt;= <span class="number">2</span>*k; --i)&#123;</span><br><span class="line">			<span class="keyword">if</span> (presum[i] &gt; sum)&#123;</span><br><span class="line">        		sum = presum[i];</span><br><span class="line">        		idx = i;</span><br><span class="line">        	&#125;</span><br><span class="line">        	maxFR[i] = idx;</span><br><span class="line">        &#125;</span><br><span class="line">        sum = <span class="number">0</span>; idx = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = k; i &lt;= n<span class="number">-2</span>*k; ++i)&#123;</span><br><span class="line">        	<span class="keyword">long</span> tmp = presum[maxFL[i-k]]+presum[i]+presum[maxFR[i+k]];</span><br><span class="line">        	<span class="keyword">if</span> (tmp &gt; sum)&#123;</span><br><span class="line">        		sum = tmp;</span><br><span class="line">        		idx = i;</span><br><span class="line">        	&#125;</span><br><span class="line">        &#125;   </span><br><span class="line">        return &#123;maxFL[idx-k], idx, maxFR[idx+k]&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
<li>
<p><strong>Interfaces and Inheritance in Java</strong></p>
<p>Interface inheitance: An Interface can extend other interface.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Class: Smple —implements—&gt; Interface: intFB —extends—&gt;Interface: intFA</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">intFA</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">geekName</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">intFB</span> <span class="keyword">extends</span> <span class="title">intFA</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">geekInstitute</span><span class="params">()</span></span><br><span class="line">&#125;</span><br><span class="line">class sample implements intFB</span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">geekName</span><span class="params">()</span></span>&#123;...&#125;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">geekInstitute</span><span class="params">()</span></span>&#123;...&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Airbnb: <a href="https://leetcode.com/problems/employee-free-time" target="_blank" rel="external">759. Employee Free Time</a></p>
<blockquote>
<p>We are given a list <code>schedule</code> of employees, which represents the working time for each employee.</p>
<p>Each employee has a list of non-overlapping <code>Intervals</code>, and these intervals are in sorted order.</p>
<p>Return the list of finite intervals representing <strong>common, positive-length free time</strong> for <em>all</em> employees, also in sorted order.</p>
<p><strong>Example 1:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; Input: schedule = [[[1,2],[5,6]],[[1,3]],[[4,10]]]</span><br><span class="line">&gt; Output: [[3,4]]</span><br><span class="line">&gt; Explanation:</span><br><span class="line">&gt; There are a total of three employees, and all common</span><br><span class="line">&gt; free time intervals would be [-inf, 1], [3, 4], [10, inf].</span><br><span class="line">&gt; We discard any intervals that contain inf as they aren&apos;t finite.</span><br><span class="line">&gt;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p><strong>Example 2:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; Input: schedule = [[[1,3],[6,7]],[[2,4]],[[2,5],[9,12]]]</span><br><span class="line">&gt; Output: [[5,6],[7,9]]</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//similar to 252, 253</span></span><br><span class="line"><span class="keyword">class</span> Solution &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;Interval&gt; employeeFreeTime(<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;Interval&gt;&gt;&amp; schedule) &#123;</span><br><span class="line">    	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; starts, ends;</span><br><span class="line">    	<span class="keyword">for</span> (<span class="keyword">auto</span> s:schedule)</span><br><span class="line">    		<span class="keyword">for</span> (<span class="keyword">auto</span> i:s)&#123;</span><br><span class="line">	    		starts.push_back(i.start);</span><br><span class="line">	    		ends.push_back(i.end);</span><br><span class="line">    		&#125;</span><br><span class="line">    	sort(starts.begin(),starts.end());</span><br><span class="line">    	sort(ends.begin(),ends.end());</span><br><span class="line">    	<span class="built_in">vector</span>&lt;Interval&gt; ans;</span><br><span class="line">    	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; starts.size() - <span class="number">1</span>; ++i)</span><br><span class="line">    		<span class="keyword">if</span> (ends[i] &lt; starts[i+<span class="number">1</span>])</span><br><span class="line">    			ans.push_back(Interval(ends[i],starts[i+<span class="number">1</span>]));</span><br><span class="line">    		<span class="comment">// ==&gt; starts[ends[i].index] &lt; starts[i+1]</span></span><br><span class="line">    		<span class="comment">// ==&gt; there is i starts and they have already ended</span></span><br><span class="line">    		<span class="comment">// ==&gt; there is free interval x before next i+1 start</span></span><br><span class="line">    	return ans; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><a href="https://leetcode.com/problems/merge-intervals" target="_blank" rel="external">56. Merge Intervals</a> | <strong>Sort</strong></p>
<blockquote>
<p>Given a collection of intervals, merge all overlapping intervals.</p>
<p>For example,<br>
Given <code>[1,3],[2,6],[8,10],[15,18]</code>,<br>
return <code>[1,6],[8,10],[15,18]</code>.</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Solution &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;Interval&gt; merge(<span class="built_in">vector</span>&lt;Interval&gt;&amp; intervals) &#123;</span><br><span class="line">        <span class="keyword">if</span> (intervals.empty())</span><br><span class="line">            return &#123;&#125;;</span><br><span class="line">        sort(intervals.begin(), intervals.end(), [](Interval a, Interval b)&#123;return a.start &lt; b.start;&#125;);</span><br><span class="line">        <span class="keyword">int</span> end = intervals[<span class="number">0</span>].end, beg = intervals[<span class="number">0</span>].start;</span><br><span class="line">        <span class="built_in">vector</span>&lt;Interval&gt; ans;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;intervals.size(); i++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (intervals[i].start&lt;=end)</span><br><span class="line">                end = max(end,intervals[i].end);</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                ans.push_back(Interval(beg,end));</span><br><span class="line">                beg = intervals[i].start;</span><br><span class="line">                end = intervals[i].end;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (beg!=<span class="number">-1</span>)</span><br><span class="line">            ans.push_back(Interval(beg,end));</span><br><span class="line">        return ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><a href="https://leetcode.com/problems/merge-k-sorted-lists/description/" target="_blank" rel="external">23. Merge k Sorted Lists</a></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> compare&#123;</span><br><span class="line">  <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> ListNode* l1, <span class="keyword">const</span> ListNode* l2)</span></span>&#123;</span><br><span class="line">    return l1-&gt;val &gt; l2-&gt;val;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> Solution&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function">ListNode* <span class="title">mergeKLists</span><span class="params">(<span class="built_in">vector</span>&lt;ListNode*&gt;&amp; lists)</span></span>&#123;</span><br><span class="line">    priority_queue&lt;ListNode*, <span class="built_in">vector</span>&lt;ListNode*&gt;, compare&gt; q;</span><br><span class="line">    <span class="comment">//for (ListNode* l:lists)</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> l:lists)</span><br><span class="line">      <span class="keyword">if</span> (l)</span><br><span class="line">        q.push(l);</span><br><span class="line">    <span class="keyword">if</span> (q.empty())</span><br><span class="line">      return <span class="literal">NULL</span>;</span><br><span class="line">    ListNode* ans = q.top();</span><br><span class="line">    ListNode* h = ans;</span><br><span class="line">    q.pop();</span><br><span class="line">    <span class="keyword">if</span> (h-&gt;next) q.push(h-&gt;next);</span><br><span class="line">    <span class="keyword">while</span> (!q.empty())&#123;</span><br><span class="line">      h-&gt;next = q.top();</span><br><span class="line">      q.pop();</span><br><span class="line">      h = h-&gt;next;</span><br><span class="line">      <span class="keyword">if</span> (h-&gt;next) q.push(h-&gt;next);</span><br><span class="line">    &#125;</span><br><span class="line">    return ans;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Or, binary use Merge2Lists</p>
</li>
</ul>
<h5 id="materials"><a class="header-anchor" href="#materials">§</a>Materials</h5>
<p><a href="http://mp.weixin.qq.com/s?__biz=MzUzODEyMzIyOA==&amp;mid=2247483961&amp;idx=1&amp;sn=8e1dc896158b2f2f6dd63ea8a1e9ef09&amp;chksm=faddcc8acdaa459c32fdb3ec3095397b9ff2c05e845eb2cf47526f349233aae8405e43767840&amp;scene=21#wechat_redirect" target="_blank" rel="external">Meeting Rooms II -Interval  所有题型总结归纳</a></p>
<ul>
<li>
<p><a href="https://leetcode.com/problems/k-empty-slots/" target="_blank" rel="external">683. K Empty Slots</a> | <strong>sliding window</strong></p>
<blockquote>
<p>There is a garden with <code>N</code> slots. In each slot, there is a flower. The <code>N</code> flowers will bloom one by one in <code>N</code> days. In each day, there will be <code>exactly</code> one flower blooming and it will be in the status of blooming since then.</p>
<p>Given an array <code>flowers</code> consists of number from <code>1</code> to <code>N</code>. Each number in the array represents the place where the flower will open in that day.</p>
<p>For example, <code>flowers[i] = x</code> means that the unique flower that blooms at day <code>i</code> will be at position <code>x</code>, where <code>i</code> and <code>x</code> will be in the range from <code>1</code> to <code>N</code>.</p>
<p>Also given an integer <code>k</code>, you need to output in which day there exists two flowers in the status of blooming, and also the number of flowers between them is <code>k</code> and these flowers are not blooming.</p>
<p>If there isn’t such day, output -1.</p>
<p><strong>Example 1:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; Input: </span><br><span class="line">&gt; flowers: [1,3,2]</span><br><span class="line">&gt; k: 1</span><br><span class="line">&gt; Output: 2</span><br><span class="line">&gt; Explanation: In the second day, the first and the third flower have become blooming.</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p><strong>Example 2:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; Input: </span><br><span class="line">&gt; flowers: [1,2,3]</span><br><span class="line">&gt; k: 1</span><br><span class="line">&gt; Output: -1</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p><strong>Note:</strong></p>
<ol>
<li>The given array will be in the range [1, 20000].</li>
</ol>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line">flowers[i] = x : the unique flower that blooms at day i+1 will be at position x</span><br><span class="line">=&gt; day[x-1] = i+1</span><br><span class="line"></span><br><span class="line">x1 = f[i], x2 = f[j], x1 &lt; x2</span><br><span class="line">sum( x1 &lt; f[max(i,j)+1...N-1] &lt; x2) == k</span><br><span class="line">=&gt;</span><br><span class="line">sliding window</span><br><span class="line">left = x, right = x+k+1</span><br><span class="line">day[x+1]...day[x+k] &gt; max(day[left],day[right])</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">class</span> Solution &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">kEmptySlots</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; flowers, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    	<span class="keyword">int</span> ans = INT_MAX;</span><br><span class="line">    	<span class="keyword">int</span> n = flowers.size();</span><br><span class="line">    	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; days(n,<span class="number">0</span>);</span><br><span class="line">    	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">    		days[flowers[i]<span class="number">-1</span>] = i + <span class="number">1</span>;</span><br><span class="line">    	<span class="keyword">int</span> left = <span class="number">0</span>, right = k+<span class="number">1</span>;</span><br><span class="line">    	<span class="keyword">int</span> day = max(days[left],days[right]);</span><br><span class="line">    	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; right &lt; n; ++i)&#123;</span><br><span class="line">    		<span class="keyword">if</span> (days[i] &gt; day)</span><br><span class="line">    			<span class="keyword">continue</span>;</span><br><span class="line">    		<span class="keyword">if</span> (i == right) <span class="comment">// find one</span></span><br><span class="line">    			ans = min(ans,day);</span><br><span class="line">    		left = i;</span><br><span class="line">    		right = i+k+<span class="number">1</span>;</span><br><span class="line">    		day = max(days[left],days[right]);</span><br><span class="line">    	&#125;</span><br><span class="line">    	return ans == INT_MAX ? <span class="number">-1</span> : ans;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><a href="https://leetcode.com/problems/meeting-rooms" target="_blank" rel="external">252. Meeting Rooms</a> | <strong>Sort</strong></p>
<blockquote>
<p>Given an array of meeting time intervals consisting of start and end times <code>[[s1,e1],[s2,e2],...]</code> (si &lt; ei), determine if a person could attend all meetings.</p>
<p>For example,<br>
Given <code>[[0, 30],[5, 10],[15, 20]]</code>,<br>
return <code>false</code>.</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * Definition for an interval.</span><br><span class="line"> * struct Interval &#123;</span><br><span class="line"> *     int start;</span><br><span class="line"> *     int end;</span><br><span class="line"> *     Interval() : start(0), end(0) &#123;&#125;</span><br><span class="line"> *     Interval(int s, int e) : start(s), end(e) &#123;&#125;</span><br><span class="line"> * &#125;;</span><br><span class="line"> */</span></span><br><span class="line"><span class="comment">// sort with start time, itv[i].end&gt;itc[i+1].start -&gt; overloap</span></span><br><span class="line"><span class="keyword">class</span> Solution &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">canAttendMeetings</span><span class="params">(<span class="built_in">vector</span>&lt;Interval&gt;&amp; intervals)</span> </span>&#123;</span><br><span class="line">    	<span class="keyword">int</span> n = intervals.size();</span><br><span class="line">    	<span class="keyword">if</span> (n == <span class="number">0</span>)</span><br><span class="line">    		return <span class="literal">true</span>;</span><br><span class="line">    	<span class="keyword">auto</span> comp = [](Interval&amp; a, Interval&amp; b)&#123;</span><br><span class="line">    		return a.start &lt; b.start;</span><br><span class="line">    	&#125;;</span><br><span class="line">    	sort(intervals.begin(),intervals.end(),comp);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n<span class="number">-1</span>; ++i)</span><br><span class="line">        	<span class="keyword">if</span> (intervals[i].end &gt; intervals[i+<span class="number">1</span>].start)</span><br><span class="line">        		return <span class="literal">false</span>;</span><br><span class="line">        return <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><a href="https://leetcode.com/problems/meeting-rooms-ii/description/" target="_blank" rel="external">253. Meeting Rooms II</a></p>
<blockquote>
<p>Given an array of meeting time intervals consisting of start and end times <code>[[s1,e1],[s2,e2],...]</code> (si &lt; ei), find the minimum number of conference rooms required.</p>
<p>For example,<br>
Given <code>[[0, 30],[5, 10],[15, 20]]</code>,<br>
return <code>2</code>.</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line">sort with start &amp; sort with end</span><br><span class="line">i, j &lt;= i</span><br><span class="line">if si &lt; ej &lt;=&gt; i==j | when i comes, j is not end</span><br><span class="line">=&gt; overlap &amp;&amp; ej&lt;=i.end </span><br><span class="line">=&gt; since ej&lt;=i.end, add another room -&gt; i, next i</span><br><span class="line">ele next j </span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">class</span> Solution &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">minMeetingRooms</span><span class="params">(<span class="built_in">vector</span>&lt;Interval&gt;&amp; intervals)</span> </span>&#123;</span><br><span class="line">    	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; starts, ends;</span><br><span class="line">    	<span class="keyword">for</span> (<span class="keyword">auto</span> i:intervals)&#123; <span class="comment">// store with idx</span></span><br><span class="line">    		starts.push_back(i.start); </span><br><span class="line">    		ends.push_back(i.end);</span><br><span class="line">    	&#125;</span><br><span class="line">    	sort(starts.begin(),starts.end());</span><br><span class="line">    	sort(ends.begin(),ends.end());</span><br><span class="line">    	<span class="keyword">int</span> ans = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">    	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; intervals.size(); ++i)</span><br><span class="line">    		<span class="keyword">if</span> (starts[i] &lt; ends[j])</span><br><span class="line">    			++ ans; <span class="comment">// rnum[i.idx] = ans++;</span></span><br><span class="line">    		<span class="keyword">else</span> <span class="comment">// can schedule after j</span></span><br><span class="line">    			++ j; <span class="comment">// rnum[i.idx] = rnum[j++.idx]</span></span><br><span class="line">    	return ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>follow up问题：把每个 meeting room 中的 intervals 打印出来</strong></p>
</li>
<li>
<p>Given two lists of intervals, find their overlapping intervals. For example: l1: [1,5], [7,10], [12,18], [22,24], l2: [3,8], [13,15], [16,17], [18,21], [22,23]<br>
returns [3,5], [7,8], [13,15], [16,17], [18,18], [22,23]</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// if there is something wrong, please correct me</span></span><br><span class="line">two pointers: i, j</span><br><span class="line"><span class="keyword">if</span> Ai overlap Bj, </span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; overlap</span><br><span class="line">  <span class="keyword">if</span> ie = je, i++, j++,</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">if</span> is &lt;= js, i++, je = ie + <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span> j++, ie = je +<span class="number">1</span></span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">  <span class="keyword">if</span> is &lt; ie &lt;= js &lt; je, i++</span><br><span class="line">  <span class="keyword">else</span> j++</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//sort with start &amp; sort with end, then</span></span><br><span class="line"><span class="keyword">int</span> count = <span class="number">0</span>, start = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>; j &lt; ends.length;) &#123;</span><br><span class="line">			<span class="keyword">if</span> (i &lt; begs.length &amp;&amp; begs[i] &lt; ends[j]) &#123;</span><br><span class="line">				<span class="keyword">if</span> (++count == <span class="number">2</span>) &#123;</span><br><span class="line">					<span class="comment">// enter overlap</span></span><br><span class="line">					start = begs[i];</span><br><span class="line">				&#125;</span><br><span class="line">				i++;</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (i == begs.length || begs[i] &gt; ends[j]) &#123;</span><br><span class="line">				<span class="keyword">if</span> (--count == <span class="number">1</span>) &#123;</span><br><span class="line">					<span class="comment">// exit overlap</span></span><br><span class="line">					res.add(<span class="keyword">new</span> Interval(start, ends[j]));</span><br><span class="line">				&#125;</span><br><span class="line">				j++;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="comment">// begs[i] == ends[j]</span></span><br><span class="line">				<span class="keyword">if</span> (count &gt; <span class="number">1</span>) &#123;</span><br><span class="line">					<span class="comment">// already in overlap</span></span><br><span class="line">					<span class="keyword">continue</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				res.add(<span class="keyword">new</span> Interval(begs[i++], ends[j++]));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> res;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>N个员工，每个员工有若干个interval表示在这段时间是忙碌的。求所有员工都不忙的intervals。每个subarray都已经sort好。<br>
举例： [<br>
[[1, 3], [6, 7]],<br>
[[2, 4]],<br>
[[2, 3], [9, 12]].<br>
]<br>
返回 [[4, 6], [7, 9]]</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//sort with start &amp; sort with end, then</span></span><br><span class="line"><span class="keyword">int</span> count = <span class="number">0</span>, start = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>; i &lt; begs.length;) &#123;</span><br><span class="line">			<span class="keyword">if</span> (begs[i] &lt; ends[j]) &#123;</span><br><span class="line">				<span class="keyword">if</span> (++count == <span class="number">1</span>) &#123;</span><br><span class="line">					<span class="comment">// exit free time</span></span><br><span class="line">					<span class="keyword">if</span> (start &gt; <span class="number">0</span>) &#123;</span><br><span class="line">						res.add(<span class="keyword">new</span> Interval(start, begs[i]));</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				i++;</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (begs[i] &gt; ends[j]) &#123;</span><br><span class="line">				<span class="keyword">if</span> (--count == <span class="number">0</span>) &#123;</span><br><span class="line">					<span class="comment">// start free zone</span></span><br><span class="line">					start = ends[j];</span><br><span class="line">				&#125;</span><br><span class="line">				j++;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="comment">// begs[i] == ends[j]</span></span><br><span class="line">				i++;</span><br><span class="line">				j++;</span><br><span class="line">			&#125;</span><br><span class="line">			System.out.println(res);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> res;</span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
<li>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/4g8gMp5OMibAIXfDBwMv5ZQHDExQBFPt55Ot7uwn7ceicUibS84dEjrwxIRNIzibZAuPpKiadnSeDv14Z42uVicoUib1A/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1" alt=""></p>
<p>​</p>
</li>
</ul>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/03/21/What-happens-when-you-type-an-URL-in-the-browser/" itemprop="url">
                  What happens when you type an URL in the browser
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2018-03-21T15:50:25-07:00" content="2018-03-21">
              2018-03-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Web/" itemprop="url" rel="index">
                    <span itemprop="name">Web</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2018/03/21/What-happens-when-you-type-an-URL-in-the-browser/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/03/21/What-happens-when-you-type-an-URL-in-the-browser/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2018/03/21/What-happens-when-you-type-an-URL-in-the-browser/" class="leancloud_visitors" data-flag-title="What happens when you type an URL in the browser">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h5 id="reference-i"><a class="header-anchor" href="#reference-i">§</a>Reference I</h5>
<ul>
<li><a href="https://stackoverflow.com/questions/2092527/what-happens-when-you-type-in-a-url-in-browser" target="_blank" rel="external">what happens when you type in a URL in browser</a></li>
<li><a href="https://medium.com/@maneesha.wijesinghe1/what-happens-when-you-type-an-url-in-the-browser-and-press-enter-bb0aa2449c1a" target="_blank" rel="external">What happens when you type an URL in the browser and press enter?</a></li>
</ul>
<h5 id="process"><a class="header-anchor" href="#process">§</a>Process</h5>
<blockquote>
<p>Attention: this is an extremely rough and <strong>oversimplified</strong> sketch, assuming the simplest possible HTTP request (no HTTPS, no HTTP2, no extras), simplest possible DNS, no proxies, single-stack IPv4, one HTTP request only, a simple HTTP server on the other end, and no problems in any step.</p>
</blockquote>
<ol>
<li>
<p>browser checks cache; if requested object is in cache and is fresh, skip to #9</p>
<ol>
<li>Browser cache. The browser maintains a repository of DNS records for a fixed duration for websites you have previously visited</li>
</ol>
</li>
<li>
<p>browser asks OS for server’s IP address</p>
<ol start="2">
<li>
<p>OS cache.  the browser would make a system call (i.e. <em>gethostname</em> on Windows) to your underlying computer OS</p>
</li>
<li>
<p>Router cache.</p>
</li>
<li>
<p>ISP cache. Your ISP maintains its’ own DNS server which includes a cache of DNS records.</p>
</li>
</ol>
</li>
<li>
<p>OS makes a DNS lookup and replies the IP address to the browser</p>
<p><strong>DNS</strong>(Domain Name System) is a database that maintains the name of the website (URL) and the particular IP address it links to. The main purpose of DNS is human-friendly navigation.</p>
<p>a <strong>recursive search</strong> since the search will continue repeatedly from DNS server to DNS server until it either finds the IP address we need or returns an error response saying it was unable to find it.</p>
<p>call the ISP’s DNS server a DNS recursor -&gt;  other DNS servers are called name servers</p>
<p>eg. DNS recursor -&gt; root name server -&gt; <strong>.com</strong> domain name server -&gt; <strong><a href="http://google.com" target="_blank" rel="external">google.com</a></strong> name server, find the matching IP address</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/0*udK6jZ3PjlhjqW8U.png" alt=""></p>
<p>​</p>
</li>
<li>
<p>browser opens a TCP connection to server (this step is much more complex with HTTPS)</p>
<p>TCP/IP <strong>three-way handshake</strong>: the client and the server exchange SYN(synchronize) and ACK(acknowledge)</p>
</li>
<li>
<p>browser sends the HTTP request through TCP connection</p>
<p>GET/POST request, also contain additional information such as browser identification (<em>User-Agent</em> header), types of requests that it will accept (<em>Accept</em>header), and connection headers asking it to keep the TCP connection alive for additional requests.</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/0*SyxEqHOBZElX5laf.png" alt="Example"></p>
</li>
<li>
<p>browser receives HTTP response and may close the TCP connection, or reuse it for another request</p>
<p>The server response contains the web page you requested as well as the status code, compression type (<em>Content-Encoding)</em>, how to cache the page (<em>Cache-Control</em>), any cookies to set, privacy information, etc.</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/0*ifRt45gihG_AwR3Z.png" alt="Example"></p>
</li>
<li>
<p>browser checks if the response is a redirect or a conditional response (3xx result status codes), authorization request (401), error (4xx and 5xx), etc.; these are handled differently from normal responses (2xx)</p>
</li>
<li>
<p>if cacheable, response is stored in cache</p>
</li>
<li>
<p>browser decodes response (e.g. if it’s gzipped)</p>
</li>
<li>
<p>browser determines what to do with response (e.g. is it a HTML page, is it an image, is it a sound clip?)</p>
</li>
<li>
<p>browser renders response, or offers a download dialog for unrecognized types</p>
<p>First, it will render the bare bone HTML skeleton.</p>
<p>Then it will check the HTML tags and sends out GET requests for additional elements on the web page, such as images, CSS stylesheets, JavaScript files etc. These static files are cached by the browser so it doesn’t have to fetch them again the next time you visit the page.</p>
<p>At the end, you’ll see the page</p>
</li>
</ol>
<h5 id="reference-ii"><a class="header-anchor" href="#reference-ii">§</a>Reference II</h5>
<ul>
<li><a href="http://www.dailichun.com/2018/03/12/whenyouenteraurl.html" target="_blank" rel="external">从输入URL到页面加载的过程？如何由一道题完善自己的前端知识体系！</a></li>
<li><a href="http://fex.baidu.com/blog/2014/05/what-happen/" target="_blank" rel="external">从输入 URL 到页面加载完成的过程中都发生了什么事情？</a></li>
</ul>
<h5 id="details"><a class="header-anchor" href="#details">§</a>Details</h5>
<ol>
<li>
<p>从浏览器接收url到开启网络请求线程（这一部分可以展开浏览器的机制以及进程与线程之间的关系）</p>
<ul>
<li>浏览器多进程：Browser进程（主控），第三方插件进程，GPU进程，浏览器渲染进程（内核，默认每个Tab页面一个进程）</li>
<li>多线程的浏览器内核<br>
<img src="https://dailc.github.io/staticResource/blog/basicKnowledge/whenyouenteraurl/browser_inner_thread.png" alt=""></li>
<li>解析URL：<code>protocol</code>://<code>host</code>:<code>port</code>/<code>path</code>/<code>query</code>#<code>fragment</code></li>
</ul>
</li>
<li>
<p>开启网络线程到发出一个完整的http请求（这一部分涉及到dns查询，tcp/ip请求，五层因特网协议栈等知识）</p>
<ul>
<li>
<p>DNS解析 -&gt; IP Adress</p>
</li>
<li>
<p><code>tcp/ip</code>请求构建：3次握手规则建立连接，断开连接时的四次挥手</p>
</li>
<li>
<p>五层因特网协议栈：</p>
<ol>
<li>应用层(dns,http) DNS解析成IP并发送http请求</li>
<li>传输层(tcp,udp) 建立tcp连接（三次握手）</li>
<li>网络层(IP,ARP) IP寻址</li>
<li>数据链路层(PPP) 封装成帧</li>
<li>物理层(利用物理介质传输比特流) 物理传输（然后传输的时候通过双绞线，电磁波等各种介质）</li>
</ol>
<p>OSI七层框架：<code>物理层</code>、<code>数据链路层</code>、<code>网络层</code>、<code>传输层</code>、<code>会话层</code>、<code>表示层</code>、<code>应用层</code></p>
<ol>
<li>表示层：主要处理两个通信系统中交换信息的表示方式，包括数据格式交换，数据加密与解密，数据压缩与终端类型转换等</li>
<li>会话层：它具体管理不同用户和进程之间的对话，如控制登陆和注销过程</li>
</ol>
</li>
</ul>
</li>
<li>
<p>从服务器接收到请求到对应后台接收到请求（这一部分可能涉及到负载均衡，安全拦截以及后台内部的处理等等）</p>
<p><strong>负载均衡</strong>：用户发起的请求都指向调度服务器（反向代理服务器，譬如安装了nginx控制负载均衡），然后调度服务器根据实际的调度算法，分配不同的请求给对应集群中的服务器执行，然后调度器等待实际服务器的HTTP响应，并将它反馈给用户</p>
</li>
<li>
<p>后台和前台的http交互（这一部分包括http头部、响应码、报文结构、cookie等知识，可以提下静态资源的cookie优化，以及编码解码，如gzip压缩等）</p>
<p><img src="https://dailc.github.io/staticResource/blog/basicKnowledge/whenyouenteraurl/http_ajax_headers.png" alt="Example"></p>
</li>
<li>
<p>单独拎出来的缓存问题，http的缓存（这部分包括http缓存头部，etag，catch-control等）</p>
<p><code>强缓存</code>（<code>200 from cache</code>）与<code>协商缓存</code>（<code>304</code>）</p>
<p><img src="https://dailc.github.io/staticResource/blog/basicKnowledge/whenyouenteraurl/http_cache.png" alt=""></p>
</li>
<li>
<p>浏览器接收到http数据包后的解析流程（解析html-词法分析然后解析成dom树、解析css生成css规则树、合并成render树，然后layout、painting渲染、复合图层的合成、GPU绘制、外链资源的处理、loaded和domcontentloaded等）</p>
<p><img src="https://dailc.github.io/staticResource/blog/basicKnowledge/whenyouenteraurl/browser_rending.png" alt=""></p>
<ol>
<li>
<p>解析HTML，构建DOM树</p>
</li>
<li>
<p>解析CSS，生成CSS规则树</p>
</li>
<li>
<p>合并DOM树和CSS规则，生成render树</p>
<p><img src="https://dailc.github.io/staticResource/blog/basicKnowledge/whenyouenteraurl/browser_parse_rendertree.png" alt=""></p>
</li>
<li>
<p>布局render树（Layout(reflow)/reflow），负责各元素尺寸、位置的计算</p>
</li>
<li>
<p>绘制render树（paint），绘制页面像素信息</p>
</li>
<li>
<p>浏览器会将各层的信息发送给GPU，GPU会将各层合成（composite），显示在屏幕上</p>
</li>
</ol>
</li>
<li>
<p>CSS的可视化格式模型（元素的渲染规则）</p>
<ol>
<li>
<p>包含块（Containing Block）</p>
</li>
<li>
<p>控制框（Controlling Box）</p>
</li>
<li>
<p>BFC（Block Formatting Context）</p>
<p>如何触发BFC？</p>
<ol>
<li>根元素</li>
<li><code>float</code>属性不为<code>none</code></li>
<li><code>position</code>为<code>absolute</code>或<code>fixed</code></li>
<li><code>display</code>为<code>inline-block</code>, <code>flex</code>, <code>inline-flex</code>，<code>table</code>，<code>table-cell</code>，<code>table-caption</code></li>
<li><code>overflow</code>不为<code>visible</code></li>
</ol>
</li>
<li>
<p>IFC（Inline Formatting Context）：行内元素自身如何显示以及在框内如何摆放的渲染规则</p>
</li>
</ol>
</li>
<li>
<p>JS引擎解析过程（JS的解释阶段，预处理阶段，执行阶段生成执行上下文，VO，作用域链、回收机制等等）</p>
<ul>
<li>即时编译（<code>JIT-Just In Time compiler</code>）
<ol>
<li>读取代码，进行词法分析（Lexical analysis），然后将代码分解成词元（token）</li>
<li>对词元进行语法分析（parsing），然后将代码整理成语法树（syntax tree）</li>
<li>使用翻译器（translator），将代码转为字节码（bytecode）</li>
<li>使用字节码解释器（bytecode interpreter），将字节码转为机器码</li>
</ol>
</li>
</ul>
</li>
</ol>
<ul>
<li>
<p>JS的预处理阶段：<a href="http://inimino.org/~inimino/blog/javascript_semicolons" target="_blank" rel="external">Semicolon Insertion</a>规则，分号补全，变量提升</p>
</li>
<li>
<p>JS的执行阶段</p>
<ul>
<li>
<p>变量对象(<code>Variable object，VO</code>)</p>
</li>
<li>
<p>作用域链(<code>Scope chain</code>)</p>
</li>
<li>
<p><code>this</code>：this的值只取决中进入上下文时的情况</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> baz = <span class="number">200</span>;</span><br><span class="line"><span class="keyword">var</span> bar = &#123;</span><br><span class="line">    baz: <span class="number">100</span>,</span><br><span class="line">    foo: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.baz);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> foo = bar.foo;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 进入环境：global</span></span><br><span class="line">foo(); <span class="comment">// 200，严格模式中会报错，Cannot read property 'baz' of undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 进入环境：global bar</span></span><br><span class="line">bar.foo(); <span class="comment">// 100</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>回收机制</p>
<ul>
<li>simple GC：<code>mark and sweep</code>（标记清除），引用计数</li>
<li><strong>分代回收（Generation GC）</strong>
<ul>
<li>多回收“临时对象”区（<code>young generation</code>）</li>
<li>少回收“持久对象”区（<code>tenured generation</code>）</li>
<li>减少每次需遍历的对象，从而减少每次GC的耗时</li>
</ul>
</li>
</ul>
</li>
</ul>
<ol start="9">
<li>其它（可以拓展不同的知识模块，如跨域，web安全，hybrid模式等等内容）</li>
</ol>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/03/17/X4-Design-Tiny-URL-Skyline-Problem/" itemprop="url">
                  X4_Design Tiny URL | Skyline Problem
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2018-03-17T17:01:08-07:00" content="2018-03-17">
              2018-03-17
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/System-Design/" itemprop="url" rel="index">
                    <span itemprop="name">System Design</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/System-Design/Program/" itemprop="url" rel="index">
                    <span itemprop="name">Program</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/System-Design/Program/Leetcode/" itemprop="url" rel="index">
                    <span itemprop="name">Leetcode</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2018/03/17/X4-Design-Tiny-URL-Skyline-Problem/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/03/17/X4-Design-Tiny-URL-Skyline-Problem/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2018/03/17/X4-Design-Tiny-URL-Skyline-Problem/" class="leancloud_visitors" data-flag-title="X4_Design Tiny URL | Skyline Problem">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="design-a-tiny-url-system"><a class="header-anchor" href="#design-a-tiny-url-system">§</a>Design A Tiny URL system</h4>
<h5 id="system-design"><a class="header-anchor" href="#system-design">§</a>System Design</h5>
<ul>
<li>is always about trade-off &amp;&amp; weighing pros and cons &amp;&amp; constraints</li>
<li>is also about sacrificing what is not needed &amp;&amp; optimizing what is most needed</li>
</ul>
<h5 id="problem"><a class="header-anchor" href="#problem">§</a>Problem</h5>
<ul>
<li>
<p>Ask requirement first: uique URL &lt;-&gt; unique alias</p>
</li>
<li>
<p>Ask Read or Write heavy: eg. Twitter: read heavy</p>
</li>
<li>
<p>Constraints</p>
<ol>
<li>Amount of data to store</li>
<li>Amount of traffic — QPS or the query-per-second rate(read)</li>
<li>How many new URLs per second(write)</li>
<li>Peak time / Hot spot(-&gt;Region)</li>
<li>Projection (10X times) Scalability</li>
</ol>
</li>
<li>
<p>Numbers, eg.</p>
<ol>
<li>Daily active users: 1,000,000</li>
<li>Insert: Per day: 1,000,000 * 1%(function usage) * 10(function frequency) = 100,000</li>
<li>Loop up: Per day: 1,000,000 * 100%(function usage) * 3(function frequency) = 3,000,000</li>
</ol>
</li>
<li>
<p>URLs: (lower case alphabet 26+upper case alphabet 26+ digit10)^length(=6) ~= 56.8 billions</p>
</li>
<li>
<p>Design 接口: REST APIs</p>
<ul>
<li>Status Code: 1xx Informational responses; 2XX Success, 200 success, 201 created; 3XX Redirection, 301 moved permanently; 4xx Client errors; 5xx Server errors</li>
<li>Google URL Shortener, json</li>
</ul>
</li>
<li>
<p>存储: SQL or NoSQL?</p>
<ol>
<li>是否需要丰富的 SQL Query？ NoSQL的SQL Query丰富度不如SQL，不过目前差距正在缩小，比如 MongoDB。此题不需要，该因素可以忽略。</li>
<li>是否追求效率？大多数Web Framework与SQL数据库兼容得很好(自带ORM(Object,-&gt; SQL dialect)，意味着可以少些很多代码。此题没太多业务逻辑，该因素可以忽略。</li>
<li>是否需要支持Transaction？ NoSQL不支持Transaction，但是可以在业务层做处理保证。</li>
<li>对QPS要求高不高？<br>
NoSQL性能高，MondoDB可以到10k级别，MySQL只能在k这个级别。</li>
<li>对Scalability的要求有多高？sharding，replica。</li>
</ol>
<ul>
<li>
<p>Number</p>
<p>Average size of longURL = 100 bytes</p>
<p>Average size of shortURL = 4 bytes(int)</p>
<p>State = 4 byte</p>
<p>Daily new URL = 3,000,000 * 108 = 324MB =&gt; Yearly new URL = 324*365 = 118GB</p>
</li>
<li>
<p>NoSQL,</p>
<ol>
<li><u>Randomly generate</u> 6 characters containing [A-Z, a-z, 0-9]</li>
<li>Use consistent hashing for partition: Partition By Key Or Consistent Hashing; Vitural nodes; Replication for high avaialbility</li>
<li>Use NoSQL’s distributed key-value store</li>
<li>Eventually consistent: <strong>quorum</strong>; others return checksum(eg. SHA1), if it is same with data -&gt; no need to lookup</li>
<li>Short URL already exists? What to do with conflicts? Retry</li>
</ol>
<ul>
<li>Write Optimization 1
<ul>
<li>Use centralized “Counter” to generate unique URL</li>
<li>similar to auto-increment id in SQL</li>
<li>Uniqueness guaranteed</li>
</ul>
</li>
<li>Write Optimization 2
<ul>
<li><u>Round robin</u> to different URL generators, each governing a dedicate key space</li>
<li>Partition key spaces such as “AXXXXX”, “BXXXXX” and etc.</li>
<li>Similar to sharding - avoid conflicts</li>
</ul>
</li>
</ul>
</li>
<li>
<p>SQL, <code>id(primary key), long_url(unique index), created_at</code></p>
<ul>
<li>Map 6 characters containing [A-Z, a-z, 0-9] to an <u>integer</u></li>
<li><a href="http://en.wikipedia.org/wiki/Base_conversion#Base_conversion" target="_blank" rel="external">Base Conversion</a> problem: base 62</li>
<li>More of single machine solution</li>
<li>Schema?</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Other Factors to Consider</p>
<ol>
<li>
<p>High availability</p>
</li>
<li>
<p>How to cache? Preload / Replace</p>
<p>First use sharding(分片，根据region) to partition different regions</p>
<p>You may have China DB and US DB for example</p>
<p>Use <u>redis / memcached LRU cache</u> for <u>repeated</u> query</p>
</li>
<li>
<p>Reuse popular short urls</p>
<p>Store those popular urls based on clicks.  Use the same short url</p>
</li>
<li>
<p>Custom URLs</p>
<p>(1) Use another table for custom URLs (SQL), since SQL use id rather than short_url</p>
<ul>
<li>
<ul>
<li>Need to look up two tables now for read/write</li>
<li>Atomicity not guaranteed in NoSQL</li>
</ul>
</li>
</ul>
<p>(2) Use the same table with additional boolean column (NoSQL), <code>short_url, long_url, created_at, custom(true/false)</code></p>
<ul>
<li>
<ul>
<li>Same look up, need to query the boolean column</li>
<li>Atomicity still guaranteed</li>
<li>Not working well for SQL solution, which is auto id based</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Analytics (usage of URLs), eg. referrers, browsers, countires, patforms</p>
</li>
<li>
<p>Automatic link expiration, add <code>last_read_time</code></p>
</li>
<li>
<p>Manual link removal</p>
<p>in NoSQL, such in disk, Append only operation is faster, add <code>alive(true/false)</code></p>
</li>
<li>
<p>UI v.s. API</p>
</li>
<li>
<p>User’s historical short urls, eg. with account system</p>
</li>
</ol>
</li>
<li>
<p>SQL index: use B+ tree index primary key, everytime use binary tree to find</p>
<ul>
<li>
<p>When primary key is declared, DBMS automatically creates unique index</p>
</li>
<li>
<p>Often need additional indexes</p>
</li>
<li>
<p>Using CREATE INDEX command, SQL indexes can be created on basis of any selected attribute</p>
</li>
<li>
<p>Composite index</p>
</li>
<li>
<ul>
<li>Index based on two or more attributes</li>
<li>Often used to prevent data duplication</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="218-the-skyline-problem"><a class="header-anchor" href="#218-the-skyline-problem">§</a><a href="https://leetcode.com/problems/the-skyline-problem/description/" target="_blank" rel="external">218. The Skyline Problem</a></h4>
<ul>
<li>
<p><a href="https://briangordon.github.io/2014/08/the-skyline-problem.html" target="_blank" rel="external">reference</a></p>
</li>
<li>
<p>OOD</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Building</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">Building</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> left;</span><br><span class="line">  <span class="keyword">int</span> right;</span><br><span class="line">  <span class="keyword">int</span> height;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Building</span><span class="params">(<span class="keyword">int</span> left, <span class="keyword">int</span> right, <span class="keyword">int</span> height)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.left = left;</span><br><span class="line">	<span class="keyword">this</span>.right = right;</span><br><span class="line">	<span class="keyword">this</span>.height = height;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Building o)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.height != o.height) &#123;</span><br><span class="line">      <span class="keyword">return</span> Integer.compare(<span class="keyword">this</span>.height, o.height);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.left != o.left) &#123;</span><br><span class="line">	  <span class="keyword">return</span> Integer.compare(<span class="keyword">this</span>.left, o.left);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> Integer.compare(<span class="keyword">this</span>.right, o.right);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"Building [left="</span> + left + <span class="string">", right="</span> + right + <span class="string">", height="</span> + height + <span class="string">"]"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Other test case</p>
<ul>
<li>what if left meets right (B0[1 5 10], B1[5 9 10], B2[9 12 20], B3[12 1510]) -&gt; enter first, otherwise it will add to result (wrong)</li>
<li>What if start at same and end at same (B0[1 17 3], B1[1 3 8], B2[1 4 2], B3[13 17 8], B4[14 17 2]) -&gt; when compare: if left1=left2, first enter larger height, if right1=right2, first leave smaller height</li>
</ul>
</li>
<li>
<p>code</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">	    <span class="comment">/**</span><br><span class="line">	     * The Skyline Problem</span><br><span class="line">	     *  city's skyline is the outer contour of the silhouette formed by all the buildings in that city when viewed from a distance. Now suppose you are given the locations and height of all the buildings as shown on a cityscape photo (Figure A), write a program to output the skyline formed by these buildings collectively (Figure B).</span><br><span class="line">	     *  The geometric information of each building is represented by a triplet of integers [Li, Ri, Hi], where Li and Ri are the x coordinates of the left and right edge of the ith building, respectively, and Hi is its height. It is guaranteed that 0 鈮� Li, Ri 鈮� INT_MAX, 0 &lt; Hi 鈮� INT_MAX, and Ri - Li &gt; 0. You may assume all buildings are perfect rectangles grounded on an absolutely flat surface at height 0.</span><br><span class="line">For instance, the dimensions of all buildings in Figure A are recorded as: [ [2 9 10], [3 7 15], [5 12 12], [15 20 10], [19 24 8] ] .</span><br><span class="line">The output is a list of "key points" (red dots in Figure B) in the format of [ [x1,y1], [x2, y2], [x3, y3], ... ] that uniquely defines a skyline. A key point is the left endpoint of a horizontal line segment. Note that the last key point, where the rightmost building ends, is merely used to mark the termination of the skyline, and always has zero height. Also, the ground in between any two adjacent buildings should be considered part of the skyline contour.</span><br><span class="line">For instance, the skyline in Figure B should be represented as:[ [2 10], [3 15], [7 12], [12 0], [15 10], [20 8], [24, 0] ].</span><br><span class="line">Notes:</span><br><span class="line">    The number of buildings in any input list is guaranteed to be in the range [0, 10000].</span><br><span class="line">    The input list is already sorted in ascending order by the left x position Li.</span><br><span class="line">    The output list must be sorted by the x position.</span><br><span class="line">    There must be no consecutive horizontal lines of equal height in the output skyline. For instance, [...[2 3], [4 5], [7 5], [11 5], [12 7]...] is not acceptable; the three lines of height 5 should be merged into one in the final output as such: [...[2 3], [4 5], [12 7], ...]</span><br><span class="line">	https://briangordon.github.io/2014/08/the-skyline-problem.html</span><br><span class="line">	     */</span></span><br><span class="line">	<span class="keyword">public</span> List&lt;<span class="keyword">int</span>[]&gt; getSkyline(<span class="keyword">int</span>[][] buildings) &#123;</span><br><span class="line">		<span class="keyword">if</span> (buildings.length == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">		&#125;</span><br><span class="line">		Building[] lefts = <span class="keyword">new</span> Building[buildings.length];</span><br><span class="line">		Building[] rights = <span class="keyword">new</span> Building[buildings.length];</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; buildings.length; i++) &#123;</span><br><span class="line">			<span class="keyword">int</span>[] b = buildings[i];</span><br><span class="line">			Building building = <span class="keyword">new</span> Building(b[<span class="number">0</span>], b[<span class="number">1</span>], b[<span class="number">2</span>]);</span><br><span class="line">			rights[i] = lefts[i] = building;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//sort according to left</span></span><br><span class="line">		Arrays.sort(lefts, (a, b) -&gt; &#123;</span><br><span class="line">			<span class="keyword">if</span> (a.left != b.left) &#123;</span><br><span class="line">				<span class="keyword">return</span> Integer.compare(a.left, b.left);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> Integer.compare(b.height, a.height);</span><br><span class="line">		&#125;);</span><br><span class="line">		<span class="comment">//sort according to right</span></span><br><span class="line">		Arrays.sort(rights, (a, b) -&gt; &#123;</span><br><span class="line">			<span class="keyword">if</span> (a.right != b.right) &#123;</span><br><span class="line">				<span class="keyword">return</span> Integer.compare(a.right, b.right);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> Integer.compare(a.height, b.height);</span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line">		System.out.println(Arrays.toString(lefts));</span><br><span class="line">		System.out.println(Arrays.toString(rights));</span><br><span class="line">		List&lt;<span class="keyword">int</span>[]&gt; result = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">		TreeSet&lt;Building&gt; set = <span class="keyword">new</span> TreeSet&lt;&gt;(); <span class="comment">// will use compareTo to compare</span></span><br><span class="line">		<span class="keyword">int</span> leftsIndex = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">int</span> rightsIndex = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">int</span> h = lefts[<span class="number">0</span>].height; <span class="comment">// max height of buildings in set</span></span><br><span class="line">		<span class="keyword">int</span> top = h; <span class="comment">// last seen h</span></span><br><span class="line">		set.add(lefts[<span class="number">0</span>]);</span><br><span class="line">		result.add(<span class="keyword">new</span> <span class="keyword">int</span>[] &#123; lefts[<span class="number">0</span>].left, top &#125;);</span><br><span class="line">		<span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span> (rightsIndex &lt; buildings.length) &#123;</span><br><span class="line">			<span class="keyword">if</span> (leftsIndex == buildings.length || rights[rightsIndex].right &lt; lefts[leftsIndex].left) &#123;</span><br><span class="line">				index = rights[rightsIndex].right;</span><br><span class="line">				System.out.println(<span class="string">"Remove "</span> + rights[rightsIndex]);</span><br><span class="line">				set.remove(rights[rightsIndex++]);</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				index = lefts[leftsIndex].left;</span><br><span class="line">				System.out.println(<span class="string">"Add "</span> + lefts[leftsIndex]);</span><br><span class="line">				set.add(lefts[leftsIndex++]);</span><br><span class="line">			&#125;</span><br><span class="line">			System.out.println(set);</span><br><span class="line">			h = set.isEmpty() ? <span class="number">0</span> : set.last().height;</span><br><span class="line">			<span class="keyword">if</span> (h != top) &#123;</span><br><span class="line">				top = h;</span><br><span class="line">				result.add(<span class="keyword">new</span> <span class="keyword">int</span>[] &#123; index, top &#125;);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">/*</span><br><span class="line">sol1: h[mostL...mostR]</span><br><span class="line">sol2:</span><br><span class="line">maintain a PQ &lt;height,end time&gt;</span><br><span class="line">cur = 0,</span><br><span class="line">nexT = PQ top end time;</span><br><span class="line">if cur.begT &gt; next // it ends before others coming</span><br><span class="line">	pop all the buildings in Pq whose enttime &lt;= nextT;</span><br><span class="line">else&#123;</span><br><span class="line">	push all the buildings at the same time,cur++</span><br><span class="line">	nexT = cur.beg</span><br><span class="line">&#125;</span><br><span class="line">//nexT = PQ's heightest building's end time</span><br><span class="line">curH = PQ's heightest or 0;</span><br><span class="line">if != last height </span><br><span class="line">	add curH,nexT</span><br><span class="line"></span><br><span class="line">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Solution &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&gt; getSkyline(<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt;&amp; buildings) &#123;</span><br><span class="line">    	<span class="built_in">vector</span>&lt;pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;&gt; ans;</span><br><span class="line">    	priority_queue&lt;pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;&gt; aliveB;</span><br><span class="line">    	<span class="keyword">int</span> cur = <span class="number">0</span>, nexT = <span class="number">0</span>, curH = <span class="number">0</span>, len = buildings.size();</span><br><span class="line">    	<span class="keyword">while</span> (!aliveB.empty() || (cur&lt;len))&#123;</span><br><span class="line">    		<span class="keyword">if</span> (aliveB.empty())</span><br><span class="line">    			nexT = buildings[cur][<span class="number">0</span>];</span><br><span class="line">    		<span class="keyword">else</span> </span><br><span class="line">    			nexT = aliveB.top().second;</span><br><span class="line">    		<span class="keyword">if</span> ((cur&gt;=len)||(buildings[cur][<span class="number">0</span>]&gt;nexT))</span><br><span class="line">    			<span class="keyword">while</span> (!aliveB.empty() &amp;&amp; aliveB.top().second&lt;= nexT)</span><br><span class="line">    				aliveB.pop();</span><br><span class="line">    		<span class="keyword">else</span>&#123;</span><br><span class="line">    			nexT = buildings[cur][<span class="number">0</span>];</span><br><span class="line">    			<span class="keyword">while</span> ((cur&lt;len)&amp;&amp;(buildings[cur][<span class="number">0</span>]==nexT))&#123;</span><br><span class="line">    				aliveB.push(make_pair(buildings[cur][<span class="number">2</span>],buildings[cur][<span class="number">1</span>]));</span><br><span class="line">    				cur++;</span><br><span class="line">    			&#125;</span><br><span class="line">    		&#125;</span><br><span class="line">    		<span class="keyword">if</span> (aliveB.empty())</span><br><span class="line">    			curH = <span class="number">0</span>;</span><br><span class="line">    		<span class="keyword">else</span> </span><br><span class="line">    			curH = aliveB.top().first;</span><br><span class="line">    		<span class="keyword">if</span> ((ans.empty())||(ans.back().second!=curH))</span><br><span class="line">    			ans.push_back(make_pair(nexT, curH));</span><br><span class="line">    	&#125;</span><br><span class="line">    	return ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Interval: <a href="">253. Meeting Rooms II</a></p>
</li>
</ul>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/03/17/System-Design-II/" itemprop="url">
                  System Design II
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2018-03-17T10:52:13-07:00" content="2018-03-17">
              2018-03-17
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/System-Design/" itemprop="url" rel="index">
                    <span itemprop="name">System Design</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2018/03/17/System-Design-II/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/03/17/System-Design-II/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2018/03/17/System-Design-II/" class="leancloud_visitors" data-flag-title="System Design II">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h5 id="scalability"><a class="header-anchor" href="#scalability">§</a>Scalability</h5>
<ul>
<li>
<p>concepts</p>
<ul>
<li>Vertical scaling: CPU(more cores, L2 Cache…), Disk(PATA, SATA, SAS…; RAID), RAM…</li>
<li>Horizontal scaling: get a bunch of slower or at least cheaper machines instand of plural number of machines</li>
<li>Caching</li>
<li>Load balancing: traffic come from people -&gt; distributed or balanced</li>
<li>Database replication
<ul>
<li>have master-slave; in case of database dies; if more read heavy &gt; write heavy =&gt; select statements go to server 2,3,4, any inserts, updates or deletes go to go to server 1</li>
<li>have master-master: can write any server; if connection down, you can read from master</li>
</ul>
</li>
<li>Database partitioning</li>
</ul>
<p>​</p>
<ul>
<li>Using NoSQL instead of scaling a relational database</li>
<li>Being asynchronous</li>
<li>how to deal with the two major bottlenecks: handling a lot of users, and handling a lot of data</li>
</ul>
</li>
<li>
<p>eg.</p>
<ul>
<li><a href="http://highscalability.com/blog/2016/10/12/lessons-learned-from-scaling-uber-to-2000-engineers-1000-ser.html" target="_blank" rel="external">Uber</a>: A nice article about how Uber had to scale fast, about breaking your service into many micro services spread across many repos</li>
<li><a href="http://highscalability.com/blog/2016/6/27/how-facebook-live-streams-to-800000-simultaneous-viewers.html" target="_blank" rel="external">Facebook</a>: How Facebook handles 800,000 simultaneous viewers on a live stream</li>
<li><a href="http://highscalability.com/blog/2016/4/20/how-twitter-handles-3000-images-per-second.html" target="_blank" rel="external">Twitter</a>: How Twitter handles 3,000 image uploads per second and why the old ways it used would not work nowadays.  Twitter subcomponents: Storing data (<a href="http://www.youtube.com/watch?v=5cKTP36HVgI" target="_blank" rel="external">video</a> | <a href="http://highscalability.com/blog/2011/12/19/how-twitter-stores-250-million-tweets-a-day-using-mysql.html" target="_blank" rel="external">text</a>), and Timeline (<a href="http://www.infoq.com/presentations/Twitter-Timeline-Scalability" target="_blank" rel="external">video</a> | <a href="http://highscalability.com/blog/2013/7/8/the-architecture-twitter-uses-to-deal-with-150m-active-users.html" target="_blank" rel="external">text</a>).</li>
<li><a href="http://highscalability.com/blog/2013/9/23/salesforce-architecture-how-they-handle-13-billion-transacti.html" target="_blank" rel="external">Salesforce</a>: A relatively short example from Salesforce.</li>
<li><a href="http://highscalability.com/google-architecture" target="_blank" rel="external">Google</a>, Youtube (<a href="http://www.youtube.com/watch?v=w5WVu624fY8" target="_blank" rel="external">video</a> | <a href="http://highscalability.com/youtube-architecture" target="_blank" rel="external">text</a>), <a href="http://highscalability.com/blog/2012/2/13/tumblr-architecture-15-billion-page-views-a-month-and-harder.html" target="_blank" rel="external">Tumblr</a>, <a href="http://highscalability.com/blog/2009/8/5/stack-overflow-architecture.html" target="_blank" rel="external">StackOverflow</a>, and <a href="http://highscalability.com/blog/2011/11/29/datasift-architecture-realtime-datamining-at-120000-tweets-p.html" target="_blank" rel="external">Datashift</a>.</li>
</ul>
</li>
<li>
<p>Warp-up</p>
<p>You first build a high-level architecture by identifying the constraints and use cases, sketching up the major components and the relationships between them, and thinking about the system’s bottlenecks. You then apply the right scalability patterns that will take care of these bottlenecks in the context of the system’s constraints.</p>
<ul>
<li>
<p>eg. Scalable design</p>
<ol>
<li>
<p>Application Service layer</p>
<ul>
<li>Start with one machine</li>
<li>Measure how far it takes us (load tests)</li>
<li>Add a load balance + a cluster of machines over time: to deal with spike-y traffic, to increase availability</li>
</ul>
</li>
<li>
<p>Data storage</p>
<ol>
<li>
<p>Billions of objects</p>
</li>
<li>
<p>Each object is fairly smaill(&lt;1K)</p>
</li>
<li>
<p>There are no relationships between the objects</p>
</li>
<li>
<p>Reads are 9x more frequent than writes (360 reads, 40 writes per second)</p>
</li>
<li>
<p>3TBs of urls, 36GB of hases</p>
</li>
</ol>
<p>MySQL:</p>
<ul>
<li>Widely used</li>
<li>Mature technology</li>
<li>Clear acling paradigms(sharding, master/slave replication, master/master replication)</li>
<li>Used by Facebook, Twitter, Google, etc.</li>
<li>Index lookups are very fast</li>
</ul>
<p>mappings</p>
<ul>
<li>hash: varchar(6)</li>
<li>original_url: varchar(512)</li>
</ul>
<ol>
<li>
<p>Create a uniquue index on the hash(36GB+). We want to hold it in memory.</p>
</li>
<li>
<p>Option 1: Vertival sacling of the MySQL machine</p>
</li>
<li>
<p>Option 2: Partition the data: 5 partitions, 600GB of data, 8GB of indexes</p>
</li>
<li>
<p>Master-slave (reading from the slaves, writes to the master)</p>
</li>
</ol>
<p>=&gt;</p>
<ol>
<li>Use one MySQL table with two varchar fields</li>
<li>Create a uniquue index on the hash(36GB+). We want to hold it in memory to speed up lookups.</li>
<li>Vertival sacling of the MySQL machine for a while</li>
<li>Eventually, partition the data by taking the first chr of the hash mod the number of partitions. Thinks about a master-slave setup.</li>
</ol>
</li>
</ol>
</li>
</ul>
</li>
<li>
<p>Example: <a href="https://www.hiredintech.com/classrooms/system-design/lesson/67" target="_blank" rel="external">The Twitter Problem</a>, <a href="https://www.hiredintech.com/classrooms/system-design/lesson/101" target="_blank" rel="external">The Summarization Problem</a></p>
</li>
</ul>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.JPG"
               alt="Zoey HAN" />
          <p class="site-author-name" itemprop="name">Zoey HAN</p>
          <p class="site-description motion-element" itemprop="description">CS | Web | Write | Music</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">30</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">12</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">21</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/ZoeyeoZ" target="_blank" title="GitHub">
                  
                    <i class="fa fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/5139990830" target="_blank" title="Weibo">
                  
                    <i class="fa fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.facebook.com/zoey.hz" target="_blank" title="facebook">
                  
                    <i class="fa fa-facebook"></i>
                  
                  facebook
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.csdn.net/zoeyyeoz" target="_blank" title="csdn">
                  
                    <i class="fa fa-book"></i>
                  
                  csdn
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zoey HAN</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"ZoeyeoZ"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  





  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';                
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });
                            
                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').mousedown(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>

  
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("T1GdtjiH3C4zaGGuAfBXLIU9-gzGzoHsz", "E1lU2mO5DS4clhzdUCD45SXs");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->



  

</body>
</html>
